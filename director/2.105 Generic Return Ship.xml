<?xml version="1.0" encoding="ISO-8859-1" ?>
<?xml-stylesheet href="director.xsl" type="text/xsl" ?>
<director name="template" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="director.xsd">
  <documentation>
    <author name="Owen Lake" alias="Xenon_Slayer" contact="E-Mail: Owen@egosoft.com Skype: Owen Lake" />
    <content reference="L2M105" name="Generic Return Ship" description="Generic claim and return ship mission"/>
    <version number="0.4" date="28/05/2008" status="release"/>
  </documentation>
  <cues>
    <cue name="L2M105" library="1" check="cancel">
      <documentation>
        <content name="Generic Return Ship" reference="L2M105" type="L2"/>
        <version date="29/04/2010" number="1.2" status="release"/>
        <params>
          <param name="WarMission" type="boolean" description="Is this a war mission?"/>
          <param name="WarRace" type="number" description="Race ID of the War Faction you are working for"/>
        </params>
        <history>
          <change date="29/04/2010" author="Owen Lake" description="Fixed the destination gate variable"/>
          <change date="06/10/2008" author="Owen Lake" description="L2M105 Return Ship Accepted V2: Fixed claimable ship creation"/>
          <change date="04/05/2008" author="Owen Lake" description="Actor now destroyed at end. Added timeout feature. Changed difficulty"/>
        </history>
      </documentation>
      <condition>
        <check_all>
          <check_any>
            <check_all>
              <check_value value="{param.exists@WarMission}" exact="1"/>
              <check_value value="{param@WarMission}" exact="1"/>
            </check_all>
            <check_value value="{player.sector.warobjectid}" exact="0"/>
          </check_any>
          <count_stations min="1" dockingallowed="1" friend="1" neutral="1" race="default|terran|goner|pirategroup|corporations|other1">
            <sector sector="{player.sector}"/>
          </count_stations>
        </check_all>
      </condition>
      <action>
        <do_all>
          <do_if value="{param.exists@WarMission}" exact="1">
            <do_if value="{param@WarMission}" exact="1">
              <set_value name="L2M105.WarMission" exact="1"/>
              <set_value name="L2M105.WarRace" exact="{param@WarRace}"/>
            </do_if>
          </do_if>
          <do_choose>
            <do_when value="{value@L2M105.WarRace}" exact="0" negate="1">
              <find_station name="L2M105.OfferStation" dockingallowed="1" friend="1" neutral="1" race="{value@L2M105.WarRace}" silent="1">
                <jumps exact="0"/>
              </find_station>
            </do_when>
            <do_otherwise>
              <find_station name="L2M105.OfferStation" dockingallowed="1" friend="1" neutral="1" race="default|terran" silent="1">
                <jumps exact="0"/>
              </find_station>
            </do_otherwise>
          </do_choose>
          <do_choose>
            <do_when value="{object.exists@L2M105.OfferStation}" exact="0">
              <cancel_cue cue="L2M105"/>
            </do_when>
            <do_otherwise>
              <set_sector name="L2M105.OfferSector" value="{object.sector@L2M105.OfferStation}"/>

              <set_value name="L2M105.SectorDistance" min="1" max="4"/>
              <find_sector race="default|terran|goner|pirategroup|corporations|other1" exact="{value@L2M105.SectorDistance}" sector="L2M105.OfferSector" name="L2M105.ShipSector"/>
              <do_choose>
                <do_when value="{sector.exists@L2M105.ShipSector}" exact="0">
                  <cancel_cue cue="L2M105"/>
                </do_when>
                <do_otherwise>
                  <set_value name="L2M105.TimeOut" min="{player.age}+700" max="{player.age}+800"/>
                  <do_choose>
                    <do_when value="{object.race@L2M105.OfferStation}" exact="{lookup.race@terran}">
                      <set_value name="L2M105.OfferRace" exact="{lookup.race@terran}"/>
                    </do_when>
                    <do_when value="{value@L2M105.WarRace}" exact="0" negate="1">
                      <set_value name="L2M105.OfferRace" exact="{value@L2M105.WarRace}"/>
                    </do_when>
                    <do_otherwise>
                      <do_any>
                        <set_value name="L2M105.OfferRace" exact="{object.race@L2M105.OfferStation}" chance="5"/>
                        <set_value name="L2M105.OfferRace" exact="{random.race@default}" chance="2"/>
                      </do_any>
                    </do_otherwise>
                  </do_choose>
                </do_otherwise>
              </do_choose>
            </do_otherwise>
          </do_choose>
        </do_all>
      </action>
      <cues>
        <cue name="L2M105 Start Mission">
          <condition>
            <check_all>
              <cue_completed cue="L2M105"/>
              <object_exists object="L2M105.OfferStation"/>
              <check_value value="{sector.exists@L2M105.ShipSector}" exact="1"/>
            </check_all>
          </condition>
          <action>
            <do_all>
              <set_value name="L2M105.PageID" exact="3305"/>
              <do_any>
                <set_value name="L2M105.Variation" exact="0"/>
                <do_all>
                  <set_value name="L2M105.Variation" exact="1"/>
                  <set_value name="L2M105.TextID Title P" exact="1001"/>
                  <set_value name="L2M105.TextID Text P" exact="1002"/>
                  <set_value name="L2M105.TextID Claim P" exact="1005"/>
                  <set_value name="L2M105.TextID Return P" exact="1006"/>
                  <set_value name="L2M105.TextID Title" exact="1003"/>
                  <set_value name="L2M105.TextID Text" exact="1004"/>
                  <set_value name="L2M105.TextID Claim" exact="1007"/>
                  <set_value name="L2M105.TextID Return" exact="1008"/>
                </do_all>
                <do_all>
                  <set_value name="L2M105.Variation" exact="2"/>
                  <set_value name="L2M105.TextID Title P" exact="2001"/>
                  <set_value name="L2M105.TextID Text P" exact="2002"/>
                  <set_value name="L2M105.TextID Claim P" exact="2005"/>
                  <set_value name="L2M105.TextID Return P" exact="2006"/>
                  <set_value name="L2M105.TextID Title" exact="2003"/>
                  <set_value name="L2M105.TextID Text" exact="2004"/>
                  <set_value name="L2M105.TextID Claim" exact="2007"/>
                  <set_value name="L2M105.TextID Return" exact="2008"/>
                  <set_value name="L2M105.Ship Stolen" exact="1"/>
                </do_all>
              </do_any>
              <do_choose>
                <do_when value="{lookup.race.mask.default@{value@L2M105.OfferRace}}" exact="1">
                  <set_value name="L2M105.ShipRace" exact="{lookup.race.mask@default}"/>
                </do_when>
                <do_when value="{lookup.race.mask.terran@{value@L2M105.OfferRace}}" exact="1">
                  <set_value name="L2M105.ShipRace" exact="{lookup.race.mask@terran}"/>
                </do_when>
              </do_choose>

              <set_value name="L2M105.ClassCount" operation="add"/>
              <set_value name="L2M105.Class{value@L2M105.ClassCount}" exact="{lookup.class@m5}"/>
              <do_if value="{player.notoriety.{value@L2M105.OfferRace}.rank}" min="3">
                <set_value name="L2M105.ClassCount" operation="add"/>
                <set_value name="L2M105.Class{value@L2M105.ClassCount}" exact="{lookup.class@m4}"/>
                <set_value name="L2M105.ClassCount" operation="add"/>
                <set_value name="L2M105.Class{value@L2M105.ClassCount}" exact="{lookup.class@ts}"/>
                <set_value name="L2M105.ClassCount" operation="add"/>
                <set_value name="L2M105.Class{value@L2M105.ClassCount}" exact="{lookup.class@tp}"/>
              </do_if>
              <do_if value="{player.notoriety.{value@L2M105.OfferRace}.rank}" min="4">
                <set_value name="L2M105.M5P" exact="1"/>
                <set_value name="L2M105.M4P" exact="1"/>
              </do_if>
              <do_if value="{player.notoriety.{value@L2M105.OfferRace}.rank}" min="5">
                <set_value name="L2M105.ClassCount" operation="add"/>
                <set_value name="L2M105.Class{value@L2M105.ClassCount}" exact="{lookup.class@m3}"/>
                <set_value name="L2M105.M3P" exact="1"/>
              </do_if>
              <do_if value="{player.notoriety.{value@L2M105.OfferRace}.rank}" min="6">
                <set_value name="L2M105.ClassCount" operation="add"/>
                <set_value name="L2M105.Class{value@L2M105.ClassCount}" exact="{lookup.class@m6}"/>
              </do_if>
              <do_if value="{player.notoriety.{value@L2M105.OfferRace}.rank}" min="7">
                <set_value name="L2M105.M6M" exact="1"/>
              </do_if>
              <do_if value="{player.notoriety.{value@L2M105.OfferRace}.rank}" min="8">
                <set_value name="L2M105.ClassCount" operation="add"/>
                <set_value name="L2M105.Class{value@L2M105.ClassCount}" exact="{lookup.class@m8}"/>
              </do_if>
              <do_if value="{player.notoriety.{value@L2M105.OfferRace}.rank}" min="9">
                <set_value name="L2M105.ClassCount" operation="add"/>
                <set_value name="L2M105.Class{value@L2M105.ClassCount}" exact="{lookup.class@m7}"/>
              </do_if>
              <do_if value="{player.notoriety.{value@L2M105.OfferRace}.rank}" min="10">
                <set_value name="L2M105.M7M" exact="1"/>
              </do_if>
              <set_value name="L2M105.ClassChoice" min="1" max="{value@L2M105.ClassCount}"/>
              <set_value name="L2M105.Class" exact="{value@L2M105.Class{value@L2M105.ClassChoice}}"/>
            </do_all>
          </action>
          <cues>
            <cue name="L2M105 Return Ship" version="2">
              <action>
                <do_all>
                  <do_choose>
                    <do_when value="{value@L2M105.OfferRace}" exact="{lookup.race@goner}">
                      <create_actor name="L2M105.OfferActor" race="argon" voiceflags="32" object="L2M105.OfferStation"/>
                    </do_when>
                    <do_otherwise>
                      <create_actor name="L2M105.OfferActor" race="{value@L2M105.OfferRace}" voiceflags="32" object="L2M105.OfferStation"/>
                    </do_otherwise>
                  </do_choose>
                  <create_offer actor="L2M105.OfferActor" conversation="L2OfferNormal" cue="L2M105 Return Ship" discipline="XXXT"/>
                  <set_value name="L2M105 Return Ship.Difficulty" exact="{value@L2M105.SectorDistance}+1"/>
                  <do_choose>
                    <do_when value="{player.notoriety.{value@L2M105.OfferRace}.rank}" max="0">
                      <set_value name="L2M105 Return Ship.Difficulty" min="{lookup.level@trivial}" max="{lookup.level@average}" profile="decreasing"/>
                    </do_when>
                    <do_when value="{player.notoriety.{value@L2M105.OfferRace}.rank}" list="1|2">
                      <set_value name="L2M105 Return Ship.Difficulty" min="{lookup.level@trivial}" max="{lookup.level@hard}" profile="decreasing"/>
                    </do_when>
                    <do_when value="{player.notoriety.{value@L2M105.OfferRace}.rank}" list="3|4">
                      <set_value name="L2M105 Return Ship.Difficulty" min="{lookup.level@veryeasy}" max="{lookup.level@hard}" profile="bell"/>
                    </do_when>
                    <do_when value="{player.notoriety.{value@L2M105.OfferRace}.rank}" list="5|6">
                      <set_value name="L2M105 Return Ship.Difficulty" min="{lookup.level@veryeasy}" max="{lookup.level@veryhard}" profile="bell"/>
                    </do_when>
                    <do_when value="{player.notoriety.{value@L2M105.OfferRace}.rank}" list="7|8">
                      <set_value name="L2M105 Return Ship.Difficulty" min="{lookup.level@veryeasy}" max="{lookup.level@veryhard}" profile="increasing"/>
                    </do_when>
                    <do_otherwise>
                      <set_value name="L2M105 Return Ship.Difficulty" min="{lookup.level@easy}" max="{lookup.level@veryhard}" profile="bell"/>
                    </do_otherwise>
                  </do_choose>
                </do_all>
              </action>
              <cues>
                <cue name="L2M105 ref SRST">
                  <cues>
                    <cue ref="SRST">
                      <params>
                        <param name="Race ID" value="{value@L2M105.ShipRace}" comment="The maker race ID or the strings 'default' or 'pirategroup'"/>
                        <param name="Class ID" value="{value@L2M105.Class}" comment="The shipclass ID or the class IDs for bigship, fighter or freighter"/>
                        <param name="Cue" value="L2M105 Return Ship" comment="The Cue that the shiptype list is saved too"/>
                        <param name="CancelCue" value="L2M105 ref SRST"/>
                        <param name="Shiptype Address" value="L2M105 Return Ship.Shiptype" comment="The address that the shiptype will be saved to"/>
                        <param name="Include M3P" value="{value@L2M105.M3P}" comment="Include the M3Plus ships in the M3 search"/>
                        <param name="Include M4P" value="{value@L2M105.M4P}" comment="Include the M4Plus ships in the M4 search"/>
                        <param name="Include M5P" value="{value@L2M105.M5P}" comment="Include the M5Plus ships in the M5 search"/>
                        <param name="Include M6M" value="{value@L2M105.M6M}" comment="Include the M6M ships in the M6 search"/>
                        <param name="Include M7M" value="{value@L2M105.M7M}" comment="Include the M7M ships in the M7 search"/>
                      </params>
                    </cue>
                  </cues>
                </cue>
                <cue name="L2M105 SRST Check">
                  <condition>
                    <cue_cancelled cue="L2M105 ref SRST"/>
                  </condition>
                  <action>
                    <do_if value="{value@L2M105 Return Ship.Shiptype}" exact="0">
                      <destroy_actor actor="L2M105.OfferActor"/>
                      <cancel_cue cue="L2M105"/>
                    </do_if>
                  </action>
                  <cues>
                    <cue name="L2M105 Return Ship Briefing">
                      <condition>
                        <conversation_completed actor="L2M105.OfferActor" answer="briefing" conversation="L2OfferNormal"/>
                      </condition>
                      <action>
                        <set_value name="L2M105.TempStep" exact="1"/>
                      </action>
                      <cues>
                        <cue ref="L0M05 B">
                          <params>
                            <param name="Cue" value="L2M105 Return Ship" comment="The cue where values will be localized"/>
                            <param name="Step" value="L2M105.TempStep"/>
                            <param name="OfferRace" value="{value@L2M105.OfferRace}" comment="Offer Race ID"/>
                            <param name="PageID" value="{value@L2M105.PageID}" comment="The PageID of the text"/>
                            <param name="TextID Title" value="{value@L2M105.TextID Title P}" comment="The briefing title ID"/>
                            <param name="TextID Text" value="{value@L2M105.TextID Text P}" comment="The briefing text ID"/>
                            <param name="TextID Claim" value="{value@L2M105.TextID Claim P}" comment="The text ID for the claim objective text"/>
                            <param name="TextID Return" value="{value@L2M105.TextID Return P}" comment="The text ID for the return objective text"/>
							<param name="ShipType" value="{value@L2M105 Return Ship.Shiptype}"/>
  						    <param name="Preview" value="1"/>
							<param name="SetObjective" value="0"/>
                            <param name="Complete Briefing" value="1" comment="Run the briefing completion library"/>
                            <param name="DestName" value="L2M105.OfferStation"/>
                            <param name="Difficulty" value="{value@L2M105 Return Ship.Difficulty}" comment="The value address for the difficulty"/>
                            <!--reward parameters (in priority order)-->
                            <param name="RoundReward" value="1" comment="Round the reward to a reasonable value? Factor to round by - 1, 2, 4 or 5 are sensible."/>
                            <param name="RewardCr" value="L2M105 Return Ship.RewardCr" comment="Reward - credits"/>
                            <param name="Duration" value="L2M105 Return Ship.Duration" comment="Mission Time"/>
                          </params>
                        </cue>
                      </cues>
                    </cue>
                    <cue name="L2M105 Return Ship Accepted" version="3" comment="V3 14/10/2008: Fixed destination check">
                      <condition>
                        <conversation_completed actor="L2M105.OfferActor" answer="accept" conversation="L2OfferNormal"/>
                      </condition>
                      <action>
                        <do_all>
                          <cancel_cue cue="L2M105 Check Offer"/>
                          <do_choose>
                            <do_when value="{value@L2M105.WarMission}" exact="1">
                              <increment_statistic statistic="5350"/>
                            </do_when>
                            <do_otherwise>
                              <increment_statistic statistic="5160"/>
                            </do_otherwise>
                          </do_choose>
                          <set_value name="L2M105 Return Ship.Step" exact="1"/>
                          <remove_offer actor="L2M105.OfferActor" discipline="XXXT" conversation="L2OfferNormal"/>
                          <do_choose>
                            <do_when value="{value@L2M105.Ship Stolen}" exact="0" comment="Ship in space">
                              <set_value name="this.X" min="-40000" max="40000"/>
                              <set_value name="this.Y" min="-10000" max="10000"/>
                              <set_value name="this.Z" min="-40000" max="40000"/>
                              <create_ship name="L2M105 Return Ship.Ship" typename="{value@L2M105 Return Ship.Shiptype}" race="argon" capturable="1" alwaysbail="1">
                                <position x="{value@this.X}m" y="{value@this.Y}m" z="{value@this.Z}m"/>
                                <sector sector="L2M105.ShipSector"/>
                                <hull min="40" max="70"/>
                              </create_ship>
                              <abandon_ship object="L2M105 Return Ship.Ship" name="this.Astro"/>
                              <destroy_object object="this.Astro"/>
                            </do_when>
                            <do_otherwise comment="Ship on the run">
                              <set_value name="this.X" min="-40000" max="40000"/>
                              <set_value name="this.Y" min="-10000" max="10000"/>
                              <set_value name="this.Z" min="-40000" max="40000"/>
                              <create_ship name="L2M105 Return Ship.Ship" typename="{value@L2M105 Return Ship.Shiptype}" race="{value@L2M105.OfferRace}" capturable="1" alwaysbail="1">
                                <position x="{value@this.X}m" y="{value@this.Y}m" z="{value@this.Z}m"/>
                                <sector sector="L2M105.ShipSector"/>
                                <equipment loadout="default"/>
                                <pilot morale="5*{value@L2M105 Return Ship.Difficulty}"/>
                              </create_ship>
                              <create_actor name="L2M105 Return Ship.Ship_Pilot" race="{value@L2M105.OfferRace}" object="L2M105 Return Ship.Ship" location="pilot"/>
                              <find_sector name="L2M105.Destination" sector="L2M105.ShipSector" min="3" max="10"/>
                              <do_choose>
                                <do_when value="{sector.exists@L2M105.Destination}" exact="1">
                                  <set_command object="L2M105 Return Ship.Ship" command="movesector">
                                    <sector sector="L2M105.Destination"/>
                                  </set_command>
                                </do_when>
                                <do_otherwise>
                                  <set_value name="L2M105.TextID Text" exact="2002"/>
                                  <set_command object="L2M105 Return Ship.Ship" command="idle"/>
                                </do_otherwise>
                              </do_choose>
                            </do_otherwise>
                          </do_choose>
                        </do_all>
                      </action>
                      <cues>
                        <cue name="L2M105 Ship Finished" instantiate="static">
                          <condition>
                            <object_finished object="L2M105 Return Ship.Ship"/>
                          </condition>
                          <timing>
                            <time exact="2s"/>
                          </timing>
                          <action>
                            <do_if value="{object.race@L2M105 Return Ship.Ship}" exact="{lookup.race@player}" negate="1">
                              <find_sector name="L2M105.Destination" sector="L2M105.ShipSector" min="3" max="10"/>
                              <do_choose>
                                <do_when value="{object.exists@L2M105.Destination}" exact="1">
                                  <set_command object="L2M105 Return Ship.Ship" command="movesector">
                                    <sector sector="L2M105.Destination"/>
                                  </set_command>
                                </do_when>
                                <do_otherwise>
                                  <set_command object="L2M105 Return Ship.Ship" command="idle"/>
                                </do_otherwise>
                              </do_choose>
                            </do_if>
                          </action>
                        </cue>
                        <cue name="L2M105 Ship Captured" version="2">
                          <condition>
                            <object_captured object="L2M105 Return Ship.Ship"/>
                          </condition>
                          <action>
                            <do_all>
                              <cancel_cue cue="L2M105 Ship Finished"/>
                              <cancel_cue cue="L2M105 Ship Hit"/>
                              <cancel_cue cue="L2M105 Ship Repair"/>
                              <cancel_cue cue="L2M105 Ship Scanned"/>
                            </do_all>
                          </action>
                        </cue>
                        <cue name="L2M105 Ship Scanned" delay="1s">
                          <condition>
                            <check_all>
                              <object_exists object="L2M105 Return Ship.Ship"/>
                              <check_value value="{object.scanned@L2M105 Return Ship.Ship}" exact="1"/>
                              <check_value value="{value@L2M105.Ship Stolen}" exact="1"/>
                            </check_all>
                          </condition>
                          <action>
                            <cancel_cue cue="L2M105 Ship Hit"/>
                          </action>
                          <cues>
                            <cue name="L2M105 Ship Scanned Ref Create Pilot2" ref="L2M105 Create Pilot2"/>
                          </cues>
                        </cue>
                        <cue name="L2M105 Ship Hit">
                          <condition>
                            <check_all>
                              <object_attacked_by_player object="L2M105 Return Ship.Ship"/>
                              <check_value value="{value@L2M105.Ship Stolen}" exact="1"/>
                            </check_all>
                          </condition>
                          <action>
                            <cancel_cue cue="L2M105 Ship Scanned"/>
                          </action>
                          <cues>
                            <cue name="L2M105 Ship Hit Ref Create Pilot2" ref="L2M105 Create Pilot2"/>
                          </cues>
                        </cue>

                        <cue name="L2M105 Create Pilot2" library="1">
                          <action>
                            <do_all>
                              <set_value name="this.Subrace" exact="{value@L2M105.OfferRace}"/>
                              <do_if value="{lookup.race.mask.terran@{value@L2M105.OfferRace}}" exact="1">
                                <set_value name="this.Subrace" exact="{lookup.race@argon}"/>
                              </do_if>
                              <do_choose>
                                <do_when value="{actor.gender@L2M105 Return Ship.Ship_Pilot}" exact="{lookup.gender@female}">
                                  <create_actor name="L2M105 Return Ship.Ship_Pilot2" race="pirate" subrace="{value@this.Subrace}" character="{actor.name@L2M105 Return Ship.Ship_Pilot}" gender="female"/>
                                </do_when>
                                <do_otherwise>
                                  <create_actor name="L2M105 Return Ship.Ship_Pilot2" race="pirate" subrace="{value@this.Subrace}" character="{actor.name@L2M105 Return Ship.Ship_Pilot}" gender="male"/>
                                </do_otherwise>
                              </do_choose>
                            </do_all>
                          </action>
                          <cues>
                            <cue name="L2M105 Replace Pilot" version="2">
                              <condition>
                                <check_value value="{player.menu.dialog}" exact="0"/>
                              </condition>
                              <action>
                                <do_all>
                                  <destroy_actor actor="L2M105 Return Ship.Ship_Pilot"/>
                                  <set_actor_location actor="L2M105 Return Ship.Ship_Pilot2" object="L2M105 Return Ship.Ship" location="pilot"/>
                                </do_all>
                              </action>
                            </cue>
                          </cues>
                        </cue>

                        <cue name="L2M105 Ship Repair" delay="15s" instantiate="static" version="2">
                          <condition>
                            <check_all>
                              <object_exists object="L2M105 Return Ship.Ship"/>
                              <check_value value="{object.hull@L2M105 Return Ship.Ship}" max="70"/>
                              <check_value value="{value@L2M105.Ship Stolen}" exact="1"/>
                            </check_all>
                          </condition>
                          <action>
                            <set_hull object="L2M105 Return Ship.Ship" exact="{object.hull@L2M105 Return Ship.Ship}+1" chance="2"/>
                          </action>
                        </cue>
                        <cue name="L2M105 Return Ship ref L0M05" version="2">
                          <action>
                            <do_if value="{object.destination.route.gate.exists@L2M105 Return Ship.Ship}" exact="0">
                              <set_value name="L2M105.TextID Text" exact="2002"/>
                              <set_command object="L2M105 Return Ship.Ship" command="idle"/>
                            </do_if>
                          </action>
                          <cues>
                            <cue ref="L0M05">
                              <params>
                                <param name="Cue" value="L2M105 Return Ship" comment="The cue where values will be localized"/>
                                <param name="Step" value="L2M105 Return Ship.Step" comment="The initial objective step"/>
                                <param name="OfferRace" value="{value@L2M105.OfferRace}" comment="Offer Race ID"/>
                                <param name="PageID" value="{value@L2M105.PageID}" comment="The PageID of the text"/>
                                <param name="Direction" value="{object.destination.route.name@L2M105 Return Ship.Ship}"/>
                                <param name="TextID Title" value="{value@L2M105.TextID Title}" comment="The briefing title ID"/>
                                <param name="TextID Text" value="{value@L2M105.TextID Text}" comment="The briefing text ID"/>
                                <param name="TextID Claim" value="{value@L2M105.TextID Claim}" comment="The text ID for the claim objective text"/>
                                <param name="TextID Return" value="{value@L2M105.TextID Return}" comment="The text ID for the return objective text"/>
                                <param name="DestName" value="L2M105.OfferStation"/>
                                <param name="ShipName" value="L2M105 Return Ship.Ship"/>
                                <param name="AllowLoss" value="1"/>
                                <param name="Preview" value="0" comment="Is the briefing a preview"/>
                                <param name="SetObjective" value="1" comment="Set the objectives and run the Objective library"/>
                                <param name="Complete Briefing" value="1" comment="Run the briefing completion library"/>
                                <param name="IsPlot" value="0" comment="Is this a plot mission"/>
                                <param name="UseTimer" value="0" comment="Override the plot signal and use a timer"/>
                                <param name="Difficulty" value="{value@L2M105 Return Ship.Difficulty}" comment="The value address for the difficulty"/>
                                <param name="Duration" value="L2M105 Return Ship.Duration" comment="Mission Time"/>
                                <!--reward parameters (in priority order)-->
                                <param name="RewardCr" value="L2M105 Return Ship.RewardCr" comment="Reward - credits"/>
                                <param name="OfferActor" value="{actor@L2M105.OfferActor}" comment="The actor"/>
                                <param name="FeedbackName" value="L2M105 Return Ship.Feedback" comment="The address where the step value is stored"/>
                              </params>
                            </cue>
                          </cues>
                        </cue>
                        <cue name="L2M105 Return Ship Ended" delay="2s" version="4">
                          <condition>
                            <check_value value="{value@L2M105 Return Ship.Feedback}" exact="0" negate="1"/>
                          </condition>
                          <action>
                            <do_all>
                              <do_choose>
                                <do_when value="{value@L2M105 Return Ship.Feedback}" list="1">
                                  <!--Ship Returned-->
                                  <incoming_message author="{actor.name@L2M105.OfferActor}" text="{{value@L2M105.PageID},{value@L2M105.Variation}{value@L2M105 Return Ship.Feedback}}"/>
                                  <reward_player>
                                    <money exact="{value@L2M105 Return Ship.RewardCr}"/>
                                    <notoriety>
                                      <relation race="{value@L2M105.OfferRace}" exact="{reward.notoriety.{value@L2M105.OfferRace}@{value@L2M105 Return Ship.Difficulty}}"/>
                                    </notoriety>
                                  </reward_player>
                                  <set_owner object="L2M105 Return Ship.Ship" race="{actor.race@L2M105.OfferActor}"/>
                                  <set_actor_location actor="L2M105.OfferActor" object="L2M105 Return Ship.Ship" location="pilot"/>
                                  <set_value name="L2M105.WarScore" min="1400" max="1500"/>
                                  <remove_objective cue="L2M105 Return Ship" status="complete"/>
                                  <remove_briefing cue="L2M105 Return Ship"/>
                                </do_when>
                                <do_when value="{value@L2M105 Return Ship.Feedback}" exact="2">
                                  <!--Timeout-->
                                  <incoming_message author="{actor.name@L2M105.OfferActor}" text="{{value@L2M105.PageID},{value@L2M105.Variation}{value@L2M105 Return Ship.Feedback}}"/>
                                  <do_choose>
                                    <do_when value="{object.race@L2M105 Return Ship.Ship}" exact="{lookup.race@player}">
                                      <reward_player>
                                        <notoriety>
                                          <relation race="{value@L2M105.OfferRace}" exact="{penalty.notoriety.{value@L2M105.OfferRace}@{value@L2M105 Return Ship.Difficulty}}"/>
                                        </notoriety>
                                      </reward_player>
                                    </do_when>
                                    <do_otherwise>
                                      <destroy_object object="L2M105 Return Ship.Ship" warp="1"/>
                                      <reward_player>
                                        <notoriety>
                                          <relation race="{value@L2M105.OfferRace}" exact="{penalty.notoriety.{value@L2M105.OfferRace}@{value@L2M105 Return Ship.Difficulty}}"/>
                                        </notoriety>
                                      </reward_player>
                                    </do_otherwise>
                                  </do_choose>
                                  <remove_objective cue="L2M105 Return Ship" status="failed"/>
                                </do_when>
                                <do_when value="{value@L2M105 Return Ship.Feedback}" exact="3">
                                  <!--Ship Destroyed-->
                                  <set_value name="L2M105 Return Ship.RewardCr" operation="divide" exact="10"/>
                                  <incoming_message author="{actor.name@L2M105.OfferActor}" text="{{value@L2M105.PageID},{value@L2M105.Variation}{value@L2M105 Return Ship.Feedback}}"/>
                                  <reward_player>
                                    <money exact="{value@L2M105 Return Ship.RewardCr}"/>
                                  </reward_player>
                                  <remove_objective cue="L2M105 Return Ship" status="failed"/>
                                </do_when>
                                <do_when value="{value@L2M105 Return Ship.Feedback}" exact="4">
                                  <!--Ship Destroyed By Player-->
                                  <incoming_message author="{actor.name@L2M105.OfferActor}" text="{{value@L2M105.PageID},{value@L2M105.Variation}{value@L2M105 Return Ship.Feedback}}"/>
                                  <reward_player>
                                    <notoriety>
                                      <relation race="{value@L2M105.OfferRace}" exact="{penalty.notoriety.{value@L2M105.OfferRace}@{value@L2M105 Return Ship.Difficulty}}"/>
                                    </notoriety>
                                  </reward_player>
                                  <remove_objective cue="L2M105 Return Ship" status="failed"/>
                                </do_when>
                                <do_when value="{value@L2M105 Return Ship.Feedback}" exact="5">
                                  <!--Destination Destroyed-->
                                  <incoming_message author="{player.name}" text="{{value@L2M105.PageID},{value@L2M105.Variation}{value@L2M105 Return Ship.Feedback}}"/>
                                  <remove_objective cue="L2M105 Return Ship" status="aborted"/>
                                </do_when>
                                <do_when value="{value@L2M105 Return Ship.Feedback}" exact="6">
                                  <!--Player Failed-->
                                  <incoming_message author="{actor.name@L2M105.OfferActor}" text="{{value@L2M105.PageID},{value@L2M105.Variation}4}"/>
                                  <reward_player>
                                    <notoriety>
                                      <relation race="{value@L2M105.OfferRace}" exact="{penalty.notoriety.{value@L2M105.OfferRace}@{value@L2M105 Return Ship.Difficulty}}"/>
                                    </notoriety>
                                  </reward_player>
                                  <remove_objective cue="L2M105 Return Ship" status="failed"/>
                                </do_when>
                                <do_when value="{value@L2M105 Return Ship.Feedback}" exact="99">
                                  <!--Aborted-->
                                  <remove_objective cue="L2M105 Return Ship" status="aborted"/>
                                  <do_choose>
                                    <do_when value="{object.race@L2M105 Return Ship.Ship}" exact="{lookup.race@player}">
                                      <reward_player>
                                        <notoriety>
                                          <relation race="{value@L2M105.OfferRace}" exact="{penalty.notoriety.{value@L2M105.OfferRace}@{value@L2M105 Return Ship.Difficulty}}"/>
                                        </notoriety>
                                      </reward_player>
                                    </do_when>
                                    <do_otherwise>
                                      <destroy_object object="L2M105 Return Ship.Ship" warp="1"/>
                                      <reward_player>
                                        <notoriety>
                                          <relation race="{value@L2M105.OfferRace}" exact="{penalty.notoriety.{value@L2M105.OfferRace}@{value@L2M105 Return Ship.Difficulty}}"/>
                                        </notoriety>
                                      </reward_player>
                                    </do_otherwise>
                                  </do_choose>
                                </do_when>
                                <do_otherwise>
                                  <remove_objective cue="L2M105 Return Ship" status="aborted"/>
                                </do_otherwise>
                              </do_choose>

                              <!--War Score means the mission was successful. Increment statistics and add war score-->
                              <do_if value="{value@L2M105.WarScore}" min="1">
                                <do_choose>
                                  <do_when value="{value@L2M105.WarMission}" exact="1">
                                    <reward_player>
                                      <war>
                                        <score race="{value@L2M105.WarRace}" exact="{value@L2M105.WarScore}"/>
                                      </war>
                                    </reward_player>
                                    <increment_statistic statistic="5360"/>
                                  </do_when>
                                  <do_otherwise>
                                    <increment_statistic statistic="5170"/>
                                  </do_otherwise>
                                </do_choose>
                              </do_if>
                            </do_all>
                          </action>
                          <cues>
                            <cue name="L2M105 Cleanup Ship" delay="1s">
                              <condition>
                                <check_all>
                                  <object_exists object="L2M105 Return Ship.Ship"/>
                                  <check_value value="{object.race@L2M105 Return Ship.Ship}" exact="{lookup.race@player}" negate="1"/>
                                </check_all>
                              </condition>
                              <action>
                                <set_owner object="L2M105 Return Ship.Ship" race="neutral"/>
                              </action>
                              <cues>
                                <cue ref="LUM15">
                                  <params>
                                    <param name="RemoveShip" value="L2M105 Return Ship.Ship" comment="Ship to remove"/>
                                  </params>
                                </cue>
                              </cues>
                            </cue>
                            <cue name="L2M105 Ship Destroyed" delay="5s" version="3">
                              <condition>
                                <object_exists object="L2M105 Return Ship.Ship" negate="1"/>
                              </condition>
                              <timing>
                                <time exact="4s"/>
                              </timing>
                              <action>
                                <do_all>
                                  <destroy_group group="L2M105.Ships" warp="1"/>
                                  <cancel_cue cue="L2M105"/>
                                </do_all>
                              </action>
                            </cue>
                            <cue name="L2M105 Player Stole Ship" delay="5s">
                              <condition>
                                <check_all>
                                  <object_exists object="L2M105 Return Ship.Ship"/>
                                  <check_value value="{object.race@L2M105 Return Ship.Ship}" exact="{lookup.race@player}"/>
                                </check_all>
                              </condition>
                              <timing>
                                <time min="3m" max="10m"/>
                              </timing>
                              <cues>
                                <cue name="L2M105 Player Stole Ship Wait">
                                  <condition>
                                    <cue_completed cue="L2M105 Player Stole Ship"/>
                                  </condition>
                                  <cues>
                                    <cue name="L2M105 ref OBS">
                                      <cues>
                                        <cue ref="OBS" version="2">
                                          <params>
                                            <param name="OBS Cue" value="L2M105" comment="The cue name where the ship groups are saved too"/>
                                            <param name="OBS Cancel Cue" value="L2M105 ref OBS" comment="The cue which is canceled after the OBS finishes"/>
                                            <param name="OBS Fleet Group Name" value="Ships" comment="The group name where all main ships are saved too"/>
                                            <param name="OBS Support Fleet Group Name" value="Ships" comment="The group name where all support ships are saved too"/>
                                            <param name="OBSFleetRace" value="{value@L2M105.OfferRace}" comment="The maker race ID of the ships or the racemask 'default' or 'pirategroup'"/>
                                            <param name="OBSFleetPilotsRace" value="{value@L2M105.OfferRace}" comment="The race ID of the pilots"/>
                                            <param name="OBSMissionRank" value="{player.fightrank.rank}" comment="A 0-30 scale preferably based on the players fight rank"/>
                                            <param name="OBSDifficultyRank" value="{value@L2M105 Return Ship.Difficulty}" comment="A 1-8 scale of difficulty"/>
                                            <param name="OBSPosition" value="5km" comment="how far away should the OBS ships be from FleetPositionObject"/>
                                            <param name="OBSFleetRaceLogic" value="0" comment="0/1 Sets if the created ships will have default race logic"/>
                                            <param name="OBSFleetPositionObject" value="L2M105 Return Ship.Ship" comment="The object which will provide the location information"/>
                                            <param name="OBSFleetJobTextID" value="30002" comment="Job text id of shipname"/>
                                            <param name="OBS Dock Support" value="1" comment="0/1 Sets if the created support ships are docked with their homebase"/>
                                            <param name="OBS Support Overflow" value="1" comment="0/1 Sets if additional support ships are created outside when the homebase is full"/>
                                            <param name="OBSFleetCapturable" value="0" comment="0/1 Sets if the created ships are capturable"/>
                                          </params>
                                        </cue>
                                      </cues>
                                    </cue>
                                    <cue name="L2M105 Attack Player">
                                      <condition>
                                        <cue_cancelled cue="L2M105 ref OBS"/>
                                      </condition>
                                      <action>
                                        <set_group_command group="L2M105.Ships" command="attack" commandobject="L2M105 Return Ship.Ship"/>
                                      </action>
                                      <cues>
                                        <cue name="L2M105 Attackers Lost" delay="5s">
                                          <condition>
                                            <check_value value="{group.object.count@L2M105.Ships}" exact="0"/>
                                          </condition>
                                          <action>
                                            <cancel_cue cue="L2M105"/>
                                          </action>
                                        </cue>
                                      </cues>
                                    </cue>
                                  </cues>
                                </cue>
                              </cues>
                            </cue>
                          </cues>
                        </cue>
                      </cues>
                    </cue>
                  </cues>
                </cue>
              </cues>
            </cue>
            <cue name="L2M105 Check Offer">
              <cues>
                <cue name="L2M105 Time Out" delay="30s">
                  <condition>
                    <check_any>
                      <check_age value="{player.age}" min="{value@L2M105.TimeOut}"/>
                      <object_relation object="L2M105.OfferStation">
                        <relation relation="enemy"/>
                      </object_relation>
                    </check_any>
                  </condition>
                  <cues>
                    <cue name="L2M105 Check Comms" delay="1s">
                      <condition>
                        <check_value value="{player.menu.dialog}" exact="0"/>
                      </condition>
                      <action>
                        <do_all>
                          <destroy_actor actor="L2M105.OfferActor"/>
                          <cancel_cue cue="L2M105"/>
                        </do_all>
                      </action>
                    </cue>
                  </cues>
                </cue>
                <cue name="L2M105 Sector Out" instantiate="static">
                  <condition>
                    <object_changed_sector/>
                  </condition>
                  <action>
                    <do_if value="{player.sector}" exact="{actor.sector@L2M105.OfferActor}" negate="1">
                      <set_value name="L2M105.SectorChanges" operation="add"/>
                      <do_if value="{value@L2M105.SectorChanges}" min="2">
                        <destroy_actor actor="L2M105.OfferActor"/>
                        <cancel_cue cue="L2M105"/>
                      </do_if>
                    </do_if>
                  </action>
                </cue>
              </cues>
            </cue>
          </cues>
        </cue>
      </cues>
    </cue>
  </cues>
  <signature>uMZNuxFi7qSDFY9hFxK1ZU1Q7Bst7YG/+qw/xQx0pkIjGmR1adGi1s2BrMf3QQeYyTOfdAjA9MwdDKzCueuEtaUvFsoyRkV4FVLb7FA5M1LvvZhM970a56o1taWC7a//xd/0KXCXORJ8wF7LvgIBQcnSX+4HHovSQbXFBou2KGp8/MVm/J47MO8r2zOFbrM08F4/g6BSwgIJPPFKfBVwUnYtRgFL7Am5rRaY1yzxLKrTO2gsWwCE0pBymE0vWpdEtRa+I+FPvJxyODaHzGwh4y9sxdHTq1NAIuCTn4f0jIZwxNhZ8snf5S1r+TfP4KqUtPib231MWDElrvjgI4fkMw==</signature>
</director>