<?xml version="1.0" encoding="ISO-8859-1" ?>
<?xml-stylesheet href="director.xsl" type="text/xsl" ?>
<director name="template" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="director.xsd">
  <documentation>
    <author name="Cycrow"/>
    <content reference="L0GI04 B" name="Patrol" description="Patrol sectors to the destination sector"/>
    <version number="1.0" date="14/06/2024" status="release"/>
  </documentation>
  <cues>
    <cue name="L0GI04 B" library="1">
      <documentation>
        <content name="Patrol Briefing Dummy" reference="L0GI04 B" type="utility"/>
        <version date="11/12/2023" number="1.0" status="release"/>
        <params>
          <param name="Cue" type="cuename" description="The cue where the briefing will be localised"/>
          <param name="Step" type="valuename" description="The initial objective step"/>
          <param name="PageID" type="number" description="The PageID of the text"/>
          <param name="TextID Title" type="number" description="The briefing title ID"/>
          <param name="TextID Text" type="number" description="The briefing text ID"/>
          <param name="FinalSector" type="sectorname" description="The Address of the destination. Overrides all other criteria."/>
          <param name="PatrolSector" type="sectorname" description="The next sector on the way to the destination"/>
          <param name="EnemyRace" type="number" description="Race id or mask"/>
			<param name="Leader" type="objectid" compulsory="1" description="The leader ship to follow"/>
			<param name="LeaderActor" type="objectid" description="The actor of the leader ship (if any)"/>
          <param name="OfferRace" type="number" description="Offer Race ID"/>
          <param name="Difficulty" type="number" description="The value address for the difficulty"/>
          <param name="StoryID" type="number" description="The textID for the StoryID"/>
          <param name="ChapterID" type="number" description="The textID for the ChapterID"/>
          <param name="Preview" type="boolean" description="Is the briefing a preview"/>
          <param name="SetObjectives" type="boolean" description="Set the objectives and run the Objective library"/>
          <param name="Complete Briefing" type="boolean" description="Run the briefing completion library"/>
          <param name="IsPlot" type="boolean" compulsory="0" description="Is this a plot mission"/>
          <param name="Nodes" type="number" compulsory="0" description="Number of nodes per sector"/>
          <!--reward parameters (in priority order)-->
          <param name="RoundReward" type="number" compulsory="0" description="Round the reward to a reasonable value? Factor to round by - 1, 2, 4 or 5 are sensible."/>
          <param name="NoReward" type="boolean" compulsory="0" description="Do not add a reward"/>
          <param name="RewardCr" type="valuename" compulsory="0" description="Reward - credits"/>
          <param name="RewardFree" type="boolean" compulsory="0" description="Reward - use free text"/>
          <param name="RewardObj" type="objectname" compulsory="0" description="Reward - object"/>
          <param name="RewardWare" type="valuename" compulsory="0" description="Reward - wares"/>
          <param name="RewardAmt" type="valuename" compulsory="0" description="Reward - wares amount"/>
        </params>
      </documentation>
        <action>
            <do_all>
				<do_choose>
					<do_when value="{param@Step}" min="1">
                        <set_value name="L0GI04 B.Step" exact="{param@Step}"/>
					</do_when>
				    <do_otherwise>
                        <set_value name="L0GI04 B.Step" exact="{value@{param@Step}}"/>
				    </do_otherwise>
				</do_choose>
                <do_if value="{param.exists@Nodes}" exact="1">
					<do_if value="{param@Nodes}" min="1" negate="1">
                        <do_if value="{value@{param@Nodes}}" exact="0">
                            <do_choose>
                                <do_when value="{param@Difficulty}" min="1">
                                    <set_value name="{param@Nodes}" min="2" max="2+({param@Difficulty}/2)"/>
                                </do_when>
                                <do_otherwise>
                                    <set_value name="{param@Nodes}" min="2" max="5"/>
                                </do_otherwise>
                            </do_choose>				
                        </do_if>
					</do_if>
                </do_if>

	            <do_if value="{param.exists@RewardCr}" exact="1">
					<do_if value="{param@RewardCr}" min="1" negate="1">
                        <do_choose>
                            <do_when value="{param@Difficulty}" min="1">
                                <do_if value="{value@{param@RewardCr}}" exact="0">
                                    <set_value name="{param@RewardCr}" exact="{reward.money.{param@OfferRace}@{param@Difficulty}.XFXX}/4"/>
                                </do_if>
                            </do_when>
                            <do_otherwise>
                                <do_if value="{value@{param@RewardCr}}" exact="0">
                                    <set_value name="{param@RewardCr}" exact="{reward.money}"/>
                                </do_if>
                            </do_otherwise>
                        </do_choose>
					</do_if>
                </do_if>

                <set_value name="L0GI04 B.B Title PageID" exact="{param@PageID}"/>
                <set_value name="L0GI04 B.B Title TextID" exact="{param@TextID Title}"/>
                <do_if value="{text.exists@{value@L0GI04 B.B Title PageID},{value@L0GI04 B.B Title TextID}}" exact="0">
                    <do_if value="{param@IsPlot}" exact="1" negate="1">
                        <set_value name="L0GI04 B.B Title PageID" exact="3634"/>
                        <do_choose>
                            <do_when value="{param@Preview}" exact="1">
                                <set_value name="L0GI04 B.B Title TextID" exact="1001"/>
                            </do_when>
                            <do_otherwise>
                                <set_value name="L0GI04 B.B Title TextID" exact="1004"/>
                            </do_otherwise>
                        </do_choose>
                    </do_if>
                </do_if>

                <set_value name="L0GI04 B.B Text PageID" exact="{param@PageID}"/>
                <set_value name="L0GI04 B.B Text TextID" exact="{param@TextID Text}"/>
                <do_if value="{text.exists@{value@L0GI04 B.B Text PageID},{value@L0GI04 B.B Text TextID}}" exact="0">
                    <do_if value="{param@IsPlot}" exact="1" negate="1">
                        <set_value name="L0GI04 B.B Text PageID" exact="3634"/>
                        <do_choose>
                            <do_when value="{param@Preview}" exact="1">
                                <do_choose>
                                    <do_when value="{sector@{param@FinalSector}}" exact="{sector@{param@PatrolSector}}">
                                        <set_value name="L0GI04 B.B Text TextID" exact="1003"/>
                                    </do_when>
                                    <do_otherwise>
                                        <set_value name="L0GI04 B.B Text TextID" exact="1002"/>
                                    </do_otherwise>
                                </do_choose>
                            </do_when>
                            <do_otherwise>
                                <do_choose>
                                    <do_when value="{sector@{param@FinalSector}}" exact="{sector@{param@PatrolSector}}">
                                        <set_value name="L0GI04 B.B Text TextID" exact="1007"/>
                                    </do_when>
                                    <do_otherwise>
                                        <set_value name="L0GI04 B.B Text TextID" exact="1006"/>
                                    </do_otherwise>
                                </do_choose>
                            </do_otherwise>
                        </do_choose>
                    </do_if>
                </do_if>

				<do_choose>
					<do_when value="{param.exists@LeaderActor}" exact="1">
						<set_value name="L0GI04 B.Leader"  exact="{object@{param@LeaderActor}}"/>						
					</do_when>
				    <do_otherwise>
						<set_value name="L0GI04 B.Leader"  exact="{object@{param@Leader}}"/>						
				    </do_otherwise>
				</do_choose>

			    <do_choose>
                    <do_when value="{param@Preview}" exact="1">
                        <do_choose>
                            <do_when value="{param.exists@LeaderActor}" exact="1">
                                <create_briefing cue="{param@Cue}" targetrace="{param@EnemyRace}">
                                    <objectives>
										<objective step="{value@L0GI04 B.Step}">
											<custom action="{9620,1000017}" text="{actor.name@{param@LeaderActor}}" icon="destroy" object="{param@Leader}"/>
										</objective>
										<objective step="{value@L0GI04 B.Step}+1">
											<custom action="{35,2053}" text="{sector.name@{param@FinalSector}}" icon="destroy">
												<sector sector="{sector@{param@FinalSector}}"/>
											</custom>
										</objective>
									</objectives>
                                </create_briefing>
                            </do_when>
                            <do_otherwise>								
                                <create_briefing cue="{param@Cue}" targetrace="{param@EnemyRace}">
                                    <objectives>
                                        <objective step="{value@L0GI04 B.Step}">
                                            <custom action="{9620,1000017}" text="{object.name@{param@Leader}}" icon="destroy" object="{param@Leader}"/>
                                        </objective>
										<objective step="{value@L0GI04 B.Step}+1">
											<custom action="{35,2053}" text="{sector.name@{param@FinalSector}}" icon="destroy">
												<sector sector="{sector@{param@FinalSector}}"/>
											</custom>
										</objective>
									</objectives>
                                </create_briefing>
                            </do_otherwise>
                        </do_choose>
						<do_if value="{param.exists@OfferRace}">
							<create_briefing cue="{param@Cue}" race="{param@OfferRace}"/>
						</do_if>
					</do_when>
                    <do_otherwise>
                        <do_choose>
                            <do_when value="{player.sector}" exact="{sector@{param@PatrolSector}}">
								<do_choose>
									<do_when value="{param.exists@LeaderActor}" exact="1">
                                        <create_briefing cue="{param@Cue}" targetrace="{param@EnemyRace}">
                                            <objectives>
                                                <objective step="{value@L0GI04 B.Step}">
                                                    <custom action="{9620,1000017}" text="{actor.name@{param@LeaderActor}}" icon="destroy" object="{param@Leader}">
                                                        <sector sector="{param@PatrolSector}"/>
                                                    </custom>
                                                </objective>
                                            </objectives>
                                        </create_briefing>
									</do_when>
								    <do_otherwise>
                                        <create_briefing cue="{param@Cue}" targetrace="{param@EnemyRace}">
                                            <objectives>
                                                <objective step="{value@L0GI04 B.Step}">
                                                    <custom action="{9620,1000017}" text="{object.name@{param@Leader}}" icon="destroy" object="{param@Leader}">
                                                        <sector sector="{param@PatrolSector}"/>
                                                    </custom>
                                                </objective>
                                            </objectives>
                                        </create_briefing>
								    </do_otherwise>
								</do_choose>
                            </do_when>
                            <do_otherwise>
                                <create_briefing cue="{param@Cue}" targetrace="{param@EnemyRace}">
                                    <objectives>
                                        <objective step="{value@L0GI04 B.Step}">
                                            <flyto>
                                                <sector sector="{param@PatrolSector}"/>
                                            </flyto>
                                        </objective>
                                    </objectives>
                                </create_briefing>
                            </do_otherwise>
                        </do_choose>
                    </do_otherwise>
                </do_choose>
			
                <do_if value="{text.exists@{value@L0GI04 B.B Title PageID},{value@L0GI04 B.B Title TextID}}" exact="1">
                    <do_if value="{text.exists@{value@L0GI04 B.B Text PageID},{value@L0GI04 B.B Text TextID}}" exact="1">
                        <create_briefing cue="{param@Cue}" title="{{value@L0GI04 B.B Title PageID},{value@L0GI04 B.B Title TextID}}" text="{{value@L0GI04 B.B Text PageID},{value@L0GI04 B.B Text TextID}}" />
                    </do_if>
                </do_if>
				
				<do_if value="{param.exists@Difficulty}" exact="1">
                        <create_briefing cue="{param@Cue}">
							<mission level="{param@Difficulty}"/>							
						</create_briefing>
				</do_if>

                <do_if value="{param@SetObjective}" exact="1">
                    <do_if value="{text.exists@{value@L0GI04 B.B Title PageID},{value@L0GI04 B.B Title TextID}}" exact="1">
                        <do_if value="{text.exists@{value@L0GI04 B.B Text PageID},{value@L0GI04 B.B Text TextID}}" exact="1">
                            <set_value name="this.ObjectiveTitle" exact="1"/>
                        </do_if>
                    </do_if>
                    <do_choose>
                        <do_when value="{player.sector}" exact="{sector@{param@PatrolSector}}">
							<do_choose>
							    <do_when value="{param.exists@LeaderActor}" exact="1">
                                    <set_objective cue="{param@Cue}" targetrace="{param@EnemyRace}">
                                        <briefing cue="{param@Cue}" step="{value@L0GI04 B.Step}"/>
                                        <custom action="{9620,1000017}" text="{actor.name@{param@LeaderActor}}" icon="destroy" object="{param@Leader}"/>
                                    </set_objective>
							    </do_when>
							    <do_otherwise>
                                    <set_objective cue="{param@Cue}" targetrace="{param@EnemyRace}">
                                        <briefing cue="{param@Cue}" step="{value@L0GI04 B.Step}"/>
                                        <custom action="{9620,1000017}" text="{object.name@{param@Leader}}" icon="destroy" object="{param@Leader}"/>
                                    </set_objective>
							    </do_otherwise>
							</do_choose>
                        </do_when>
                        <do_otherwise>
                            <set_objective cue="{param@Cue}" targetrace="{param@EnemyRace}">
                                <briefing cue="{param@Cue}" step="{value@L0GI04 B.Step}"/>
                                <flyto>
                                    <sector sector="{param@PatrolSector}"/>
                                </flyto>
                            </set_objective>
                        </do_otherwise>
                    </do_choose>
            
				    <do_if value="{value@this.ObjectiveTitle}" exact="1">
                        <set_objective cue="{param@Cue}" title="{{value@L0GI04 B.B Title PageID},{value@L0GI04 B.B Title TextID}}" text="{{value@L0GI04 B.B Text PageID},{value@L0GI04 B.B Text TextID}}" silent="1"/>
                    </do_if>

					<do_if value="{param@Preview}" exact="1">
						<do_if value="{param.exists@OfferRace}">
							<set_objective cue="{param@Cue}" race="{param@OfferRace}" silent="1"/>
						</do_if>
					</do_if>

					<do_if value="{param.exists@Difficulty}" exact="1">
						<set_objective cue="{param@Cue}" silent="1">
							<mission level="{param@Difficulty}"/>							
						</set_objective>
					</do_if>
					<do_if value="{param.exists@DisplayRace}" exact="1">
						<set_objective cue="{param@Cue}" race="{param@DisplayRace}" silent="1"/>
					</do_if>
				</do_if>

				<do_if value="{param.exists@DisplayRace}" exact="1">
					<create_briefing cue="{param@Cue}" race="{param@DisplayRace}"/>
				</do_if>
				<do_if value="{param.exists@FeedbackName}" exact="1">
					<set_value name="{param@FeedbackName}" exact="0"/>
				</do_if>
				<do_if value="{param.exists@OBS Counter}" exact="1">
					<set_value name="{param@OBS Counter}" exact="0"/>
				</do_if>
			</do_all>
        </action>
        <cues>
            <cue name="L0GI04 B Complete Briefing" check="cancel">
                <condition>
                    <check_all>
                        <cue_completed cue="L0GI04 B"/>
                        <check_value value="{param@Complete Briefing}" exact="1"/>
                    </check_all>
                </condition>
                <cues>
                    <cue ref="LUM04">
                        <params>
                            <param name="Discipline" value="XFXX" comment="The mission discipline"/>
                        </params>
                    </cue>
                    <cue name="L0GI04 Set Objectives" check="cancel">
                        <condition>
                            <check_value value="{param@SetObjective}" exact="1"/>
                        </condition>
                        <cues>
                            <cue ref="LUM05">
                                <params>
                                    <param name="Discipline" value="XFXX" comment="The mission discipline"/>
                                </params>
                            </cue>
                        </cues>
                    </cue>
                </cues>
            </cue>
        </cues>
    </cue>
	  
    <cue name="L0GI04" library="1" version="2">
      <documentation>
        <content name="Patrol Mission" reference="L0GI04" type="L0"/>
        <version date="11/12/2023" number="1.0" status="testing"/>
        <params>
          <param name="Cue" type="cuename" description="The cue where the briefing will be localised"/>
          <param name="Step" type="valuename" description="The initial objective step"/>
          <param name="PageID" type="number" description="The PageID of the text"/>
          <param name="TextID Title" type="number" description="The briefing title ID"/>
          <param name="TextID Text" type="number" description="The briefing text ID"/>
          <param name="FinalSector" type="sectorname" description="The Address of the destination. Overrides all other criteria."/>
          <param name="PatrolSector" type="sectorname" description="The next sector on the way to the destination"/>
          <param name="EnemyRace" type="number" description="Race id or mask"/>
          <param name="OfferRace" type="number" description="Offer Race ID"/>
          <param name="Clear Enemies" type="boolean" description="Only move on when there are no enemies around the player"/>
          <param name="Use Offer Race Enemies" type="boolean" description="0 = Sector Owner Enemies, 1 = Enemies are enemies of the offer race. Not used if EnemyRace provided."/>
          <param name="Difficulty" type="number" description="The value address for the difficulty"/>
          <param name="StoryID" type="number" description="The textID for the StoryID"/>
          <param name="ChapterID" type="number" description="The textID for the ChapterID"/>
          <param name="Preview" type="boolean" description="Is the briefing a preview"/>
          <param name="SetObjectives" type="boolean" description="Set the objectives and run the Objective library"/>
          <param name="Complete Briefing" type="boolean" description="Run the briefing completion library"/>
          <param name="IsPlot" type="boolean" compulsory="0" description="Is this a plot mission"/>
          <param name="UseTimer" type="boolean" compulsory="0" description="Override the plot signal and use a timer"/>
          <param name="Duration" type="valuename" compulsory="0" description="Mission Time"/>
          <param name="StartTime" type="valuename" compulsory="0" description="Start Time"/>
          <param name="EndTime" type="valuename" compulsory="0" description="End Time"/>
          <param name="PatrolDest" type="boolean" description="Patrol the destination sector"/>
          <param name="PatrolTime" type="number" description="Duration of patrol per sector in seconds"/>
          <!--reward parameters (in priority order)-->
          <param name="RoundReward" type="number" compulsory="0" description="Round the reward to a reasonable value? Factor to round by - 1, 2, 4 or 5 are sensible."/>
          <param name="NoReward" type="boolean" compulsory="0" description="Do not add a reward"/>
          <param name="RewardCr" type="valuename" compulsory="0" description="Reward - credits"/>
          <param name="RewardFree" type="boolean" compulsory="0" description="Reward - use free text"/>
          <param name="RewardText" type="text" compulsory="0" description="Free text for reward" />
          <param name="RewardObj" type="objectname" compulsory="0" description="Reward - object"/>
          <param name="RewardWare" type="valuename" compulsory="0" description="Reward - wares"/>
          <param name="RewardAmt" type="valuename" compulsory="0" description="Reward - wares amount"/>

          <param name="OBSDelay" type="number" description="The delay between OBS spawns"/>
          <param name="OBS" type="boolean" description="Activate the OBS"/>
          <param name="MaxOBSRuns" type="number" description="The maximum OBS spawns. 0=Infinate"/>
          <param name="OBS Counter" type="valuename" description="The name of the OBS counter"/>
          <param name="OBS Cue" type="cuename" description="The cue name where the ship groups are saved too"/>
          <param name="OBSFleetRace" type="number" description="The maker race ID of the ships or the racemask 'default' or 'pirategroup'"/>
          <param name="OBSFleetPilotsRace" type="number" description="The race ID of the pilots"/>
          <param name="OBSMissionRank" type="number" description="A 0-30 scale preferably based on the players fight rank"/>
          <param name="OBSDifficultyRank" type="number" description="A 1-8 scale of difficulty"/>
          <param name="OBSPosition" type="number" description="how far away should the OBS ships be from OBSFleetPositionObject"/>
          <param name="OBSFleetPositionObject" type="objectid" description="The object which will provide the location information"/>
          <param name="OBSSector" type="sectorid" description="The sector where the ships will spawn if OBSFleetPositionObject not set"/>
          <param name="OBS X" type="number" description="Co-ordinate value in KM if the OBSFleetPositionObject was not set"/>
          <param name="OBS Y" type="number" description="Co-ordinate value in KM if the OBSFleetPositionObject was not set"/>
          <param name="OBS Z" type="number" description="Co-ordinate value in KM if the OBSFleetPositionObject was not set"/>
          <param name="OBSFleetCapturable" type="boolean" description="Sets if the created ships are capturable"/>
          <param name="OBSFleetCommunicates" type="boolean" description="Sets if the created ships can be communicated with"/>
          <param name="OBSFleetCovered" type="boolean" description="0/1 Sets if created pirate ships are covered"/>
          <param name="OBSFleetHomebaseID" type="boolean" description="Object ID for the fleets homebase"/>
          <param name="OBSFleetScanned" type="boolean" description="0/1 Sets if the created ships have their freight on display"/>
          <param name="OBSFleetHighlight" type="boolean" description="0/1 Sets if the created ships will be highlighted"/>
          <param name="OBSFleetRaceLogic" type="boolean"/>
          <param name="OBS Dock Support" type="boolean" description="0/1 Sets if the created support ships are docked with their homebase"/>
          <param name="OBS Support Overflow" type="boolean" description="0/1 Sets if additional support ships are created outside when the homebase is full"/>
        </params>
        <history>
          <change date="11/12/2023" author="Cycrow" description="Created initial version (based on 0.34 Patrol)"/>
        </history>
      </documentation>
      <action>
        <do_all>
			<set_value name="L0GI04.IgnoreOBS" exact="0"/>
			<do_if value="{param.exists@OBS Counter}" exact="1">
				<set_value name="{param@OBS Counter}" exact="0"/>
			</do_if>
			<set_value name="{param@FeedbackName}" exact="0"/>
			<set_value name="L0GI04.Initial Step" exact="{value@{param@Step}}"/>
          <set_value name="L0GI04.Step" exact="{value@{param@Step}}"/>

          <set_value name="L0GI04.MaxOBSPerSector" exact="{param@MaxOBSPerSector}"/>

          <set_value name="L0GI04.OBSDelay" exact="{param@OBSDelay}"/>
		  <do_if value="{value@L0GI04.OBSDelay}" max="10">
              <set_value name="L0GI04.OBSDelay" min="120*({param@Nodes}-1)" max="180*({param@Nodes}-1)"/>
		  </do_if>
          <set_value name="L0GI04.OBSTime" min="40+{player.age}" max="70+{player.age}"/>
          <set_value name="L0GI04.EnemyRace" exact="{param@EnemyRace}"/>
			<set_value name="L0GI04.Bonus" exact="300+({reward.money@easy.XFXX}/1250)"/>
			<do_choose>
				<do_when value="{param.exists@OBSResetTimePerSector}" exact="1">
					<set_value name="L0GI04.ResetOBSPerSector" exact="{param@OBSResetTimePerSector}"/>
				</do_when>
				<do_otherwise>
					<set_value name="L0GI04.ResetOBSPerSector" exact="1"/>
				</do_otherwise>
			</do_choose>
			<set_sector name="L0GI04.PatrolSector" value="{sector@{param@PatrolSector}}"/>
			<set_value name="{param@OBS Counter} {sector@L0GI04.PatrolSector}" exact="0"/>
			<set_object name="L0GI04.Leader" value="{object@{param@Leader}}"/>
			<set_attacked_response object="L0GI04.Leader" response="ignore"/>
			<do_if value="{actor.exists@{param@LeaderActor}}" exact="1">
			    <set_actor name="L0GI04.LeaderActor" value="{actor@{param@LeaderActor}}"/>
			</do_if>
			<set_value name="L0GI04.NodesRemaining" exact="-1"/>
			<set_value name="L0GI04.Status" exact="0"/>
            <set_value name="L0GI04.LeaderTalk" exact="0"/>
			<do_if value="{param.exists@LeaderTalk}" exact="1">
			    <do_if value="{param@LeaderTalk}" exact="1">
				    <do_if value="{actor.exists@L0GI04.LeaderActor}" exact="1">
                        <set_value name="L0GI04.LeaderTalk" exact="1"/>
				    </do_if>
			    </do_if>
		    </do_if>
			<set_value name="L0GI04.MaxLeaveTime" exact="0"/>
			<do_if value="{param@IsPlot}" exact="0">
				<do_choose>
					<do_when value="{param.exists@MaxLeaveTime}" exact="1">
						<set_value name="L0GI04.MaxLeaveTime" exact="{param@MaxLeaveTime}"/>
					</do_when>
					<do_otherwise>
						<set_value name="L0GI04.MaxLeaveTime" min="120" max="240"/>
					</do_otherwise>
				</do_choose>
			</do_if>
		</do_all>
      </action>
        <cues>
			<cue name="L0GI04 SectorIgnore">
				<action>
					<do_all>
						<set_value name="L0GI04.IgnoreOBS" exact="0"/>
						<do_if value="{param.exists@OBSSectorIgnoreList}" exact="1">
							<do_if value="{object.sector@L0GI04.Leader}" list="{param@OBSSectorIgnoreList}">
								<set_value name="L0GI04.IgnoreOBS" exact="1"/>
							</do_if>
						</do_if>
					</do_all>
				</action>
			</cue>

			<cue name="L0GI04 UpdateBreifing">
				<cues>
					<cue ref="L0GI04 B">
						<params>
							<param name="PatrolSector" value="L0GI04.PatrolSector"/>
						</params>
					</cue>
					<cue name="L0GI04 Update Rewards Wait">
						<timing>
							<time exact="1s"/>
						</timing>
						<cues>
							<cue name="L0GI04 Update Rewards Wait finished">
								<condition>
									<cue_completed cue="L0GI04 Update Rewards Wait"/>
								</condition>
								<cues>
									<cue ref="L0GI04 Complete Rewards"/>
								</cues>
							</cue>
						</cues>
					</cue>
				</cues>
			</cue>
			

			<cue name="L0GI04 Mission Aborted">
                <condition>
                    <objective_cancelled cue="{param@Cue}"/>
                </condition>
                <action>
                    <do_all>
                        <set_value name="{param@FeedbackName}" exact="99"/>
                        <cancel_cue cue="L0GI04"/>
                    </do_all>
                </action>
            </cue>
            
			<cue name="L0GI04 LeaderDied">
				<condition>
					<check_any>
					    <object_destroyed object="L0GI04.Leader"/>
				    </check_any>
				</condition>
				<action>
					<do_all>
   						<set_value name="L0GI04.Status" exact="7"/>
						<set_value name="{param@FeedbackName}" exact="2"/>
						<cancel_cue cue="L0GI04"/>						
					</do_all>
				</action>
			</cue>
			<cue name="L0GI04 LeaderDiedPlayer">
				<condition>
					<check_any>
					    <object_destroyed_by_player object="L0GI04.Leader"/>
						<object_captured object="L0GI04.Leader"/>
				    </check_any>
				</condition>
				<action>
					<do_all>
   						<set_value name="L0GI04.Status" exact="7"/>
						<set_value name="{param@FeedbackName}" exact="3"/>
						<cancel_cue cue="L0GI04"/>						
					</do_all>
				</action>
			</cue>
			<cue name="L0GI04 LeaderNotInSector" delay="5s">
                <condition>
					<check_all>
						<check_value value="{object.sector@L0GI04.Leader}" exact="{sector@L0GI04.PatrolSector}" negate="1"/>
						<check_value value="{object.sector@L0GI04.Leader}" exact="{sector@L0GI04.NextSector}" negate="1"/>
					</check_all>
                </condition>
				<action>
					<do_all>
					    <set_command object="{object@L0GI04.Leader}" command="movesector" commandobject="{object.sector@L0GI04.Leader}"/>
						<reset_cue cue="L0GI04 LeaderInSector"/>
					</do_all>
				</action>
			</cue>

			<cue name="L0GI04 LeaderTooFar" delay="1s">
				<condition>
					<check_all>
						<object_is_docked object="L0GI04.Leader" negate="1"/>
						<check_value value="{player.sector}" exact="{object.sector@L0GI04.Leader}"/>
						<check_value value="{value@L0GI04.AttackPhase}" exact="0"/>
						<check_value value="{value@L0GI04.LeaderStopped}" exact="0"/>
						<check_distance value="{object.distance@L0GI04.Leader}" min="7km"/>
						<check_value value="{value@L0GI04.Status}" list="2|3|8"/>
					</check_all>					
				</condition>
				<action>
					<do_all>
						<set_value name="L0GI04.LeaderWait" exact="1"/>
						<set_command object="{object@L0GI04.Leader}" command="stay"/>
						<create_briefing cue="{param@Cue}">
							<objectives>
								<objective step="{param@Step}">
									<flyto object="{object@L0GI04.Leader}"/>
								</objective>
							</objectives>
						</create_briefing>
						<set_objective cue="{param@Cue}">
							<flyto object="{object@L0GI04.Leader}"/>
						</set_objective>
					    <do_if value="{value@L0GI04.LeaderTalk}" exact="1">
                            <play_text actor="{actor@L0GI04.LeaderActor}" priority="80">
                                <line actor="{actor@L0GI04.LeaderActor}" textid="930"/>
                                <line actor="{actor@L0GI04.LeaderActor}" textid="931"/>
                            </play_text>							
						</do_if>					
					</do_all>
				</action>
				<cues>
					<cue name="L0GI04 ResumeLeaderCheck" delay="1s">
						<condition>
							<check_any>
								<cue_is_complete cue="L0GI04 BackToLeader"/>
								<cue_is_complete cue="L0GI04 BackToLeaderNext"/>
							</check_any>						
						</condition>
						<action>
							<do_all>
							    <set_value name="L0GI04.LeaderWait" exact="0"/>
								<do_if value="{value@L0GI04.LeaderTalk}" exact="1">
									<do_any>
    							        <play_text actor="{actor@L0GI04.LeaderActor}" textid="990" priority="60" chance="66"/>
	    						        <play_text actor="{actor@L0GI04.LeaderActor}" textid="991" priority="60" chance="34"/>
									</do_any>
							    </do_if>
                            </do_all>								
						</action>
					    <cues>
							<cue name="L0GI04 ResetLeaderCheck">
								<timing>
									<time exact="8s"/>
								</timing>
							    <action>
    								<reset_cue cue="L0GI04 LeaderTooFar"/>
							    </action>
							</cue>							
						</cues>
					</cue>
					<cue name="L0GI04 BackToLeader" delay="2s">
						<condition>
							<check_all>
								<check_value value="{player.sector}" exact="{object.sector@L0GI04.Leader}"/>
								<check_distance value="{object.distance@L0GI04.Leader}" max="5km"/>
								<check_any>
									<check_value value="{sector.exists@L0GI04.NextSector}" exact="0"/>
									<check_value value="{sector@L0GI04.NextSector}" exact="{object.sector@L0GI04.Leader}"/>
								</check_any>
							</check_all>
						</condition>
						<action>
							<do_all>
								<set_command object="{object@L0GI04.Leader}" command="moveposition">
									<position x="{value@L0GI04.NodeX}m" y="{value@L0GI04.NodeY}m" z="{value@L0GI04.NodeZ}m"/>
									<sector sector="{sector@L0GI04.PatrolSector}"/>
								</set_command>
								<reset_cue cue="L0GI04 UpdateBreifing"/>
							</do_all>
						</action>
					</cue>
					<cue name="L0GI04 BackToLeaderNext" delay="2s">
						<condition>
							<check_all>
								<check_value value="{player.sector}" exact="{object.sector@L0GI04.Leader}"/>
								<check_distance value="{object.distance@L0GI04.Leader}" max="5km"/>
								<check_value value="{sector.exists@L0GI04.NextSector}" exact="1"/>
								<check_value value="{sector@L0GI04.NextSector}" exact="{object.sector@L0GI04.Leader}" negate="1"/>
							</check_all>
						</condition>
						<action>
							<do_all>
								<set_command object="{object@L0GI04.Leader}" command="movesector">
									<sector sector="{sector@L0GI04.NextSector}"/>
								</set_command>
								<reset_cue cue="L0GI04 UpdateBreifing"/>
							</do_all>
						</action>
					</cue>
				</cues>
			</cue>
			<cue name="L0GI04 LeaderInSector" delay="2s">
                <condition>
					<check_all>
                        <check_value value="{object.sector@L0GI04.Leader}" exact="{sector@L0GI04.PatrolSector}"/>
						<check_value value="{value@L0GI04.NodesRemaining}" exact="-1"/>
				    </check_all>				    
                </condition>
				<action>
					<do_all>
						<do_choose>
							<do_when value="{param@Nodes}" min="1">
			                    <set_value name="L0GI04.NodesRemaining" exact="{param@Nodes}"/>						
							</do_when>
					        <do_otherwise>
			                    <set_value name="L0GI04.NodesRemaining" exact="{value@{param@Nodes}}"/>						
							</do_otherwise>
						</do_choose>
						<do_if value="{value@L0GI04.NodesRemaining}" exact="0">
			                <set_value name="L0GI04.NodesRemaining" min="1+{param@Difficulty}" max="2+{param@Difficulty}"/>						
						</do_if>
						<do_if value="{value@L0GI04.NodesRemaining}" exact="0">
			                <set_value name="L0GI04.NodesRemaining" min="3" max="6"/>						
						</do_if>
						<set_value name="L0GI04.NodeX" exact="0"/>
						<set_value name="L0GI04.NodeY" exact="0"/>
						<set_value name="L0GI04.NodeZ" exact="0"/>
                        <set_command object="{object@L0GI04.Leader}" command="moveposition">
                            <position x="0" y="0" z="0" min="0km" max="2km"/>
                            <sector sector="{sector@L0GI04.PatrolSector}"/>
                        </set_command>
						<set_value name="L0GI04.OBSTime" exact="{player.age}+1000"/>
						<reset_cue cue="L0GI04 OBS Time"/>
						<reset_cue cue="L0GI04 OBS"/>
						<set_value name="L0GI04.Status" exact="8"/>
						<reset_cue cue="L0GI04 LeaderNotInSector"/>
						<reset_cue cue="L0GI04 UpdateBreifing"/>
					</do_all>
				</action>
				<cues>
					<cue name="L0GI04 LeaderWait" delay="5s">
						<condition>
							<check_value value="{player.sector}" exact="{object.sector@L0GI04.Leader}" negate="1"/>
						</condition>
						<timing>
							<time min="10s" max="15s"/>
						</timing>
						<cues>
							<cue name="L0GI04 LeaderShouldStop">
								<condition>
									<check_all>
										<check_value value="{player.sector}" exact="{object.sector@L0GI04.Leader}" negate="1"/>
										<cue_is_complete cue="L0GI04 LeaderWait"/>
									</check_all>
								</condition>
								<action>
									<do_all>
										<set_value name="L0GI04.LeaderWait" exact="0"/>
										<set_value name="L0GI04.LeaderStopped" exact="1"/>
										<set_command object="{object@L0GI04.Leader}" command="stay"/>
									</do_all>
								</action>
								<cues>
									<cue name="L0GI04 LeaderShouldStart">
										<condition>
											<check_all>
												<cue_is_complete cue="L0GI04 LeaderShouldStop"/>
												<check_value value="{player.sector}" exact="{object.sector@L0GI04.Leader}"/>
											</check_all>
										</condition>
										<timing>
											<time exact="2s"/>
										</timing>
										<action>
											<do_all>
												<set_value name="L0GI04.LeaderStopped" exact="0"/>
												<do_if value="{value@L0GI04.LeaderWait}" exact="0">
													<do_choose>
														<do_when value="{sector.exists@L0GI04.NextSector}" exact="0">
															<set_command object="{object@L0GI04.Leader}" command="moveposition">
																<position x="{value@L0GI04.NodeX}m" y="{value@L0GI04.NodeY}m" z="{value@L0GI04.NodeZ}m" />
																<sector sector="{sector@L0GI04.PatrolSector}"/>
															</set_command>
														</do_when>
														<do_when value="{sector@L0GI04.NextSector}" exact="{object.sector@L0GI04.Leader}">
															<set_command object="{object@L0GI04.Leader}" command="moveposition">
																<position x="{value@L0GI04.NodeX}m" y="{value@L0GI04.NodeY}m" z="{value@L0GI04.NodeZ}m" />
																<sector sector="{sector@L0GI04.PatrolSector}"/>
															</set_command>
														</do_when>
														<do_otherwise>
															<set_command object="{object@L0GI04.Leader}" command="movesector">
																<sector sector="{sector@L0GI04.NextSector}"/>
															</set_command>
														</do_otherwise>
													</do_choose>
												</do_if>
											</do_all>
										</action>
									</cue>
								</cues>
							</cue>
						</cues>
					</cue>
					<cue name="L0GI04 LeaderStopped" delay="1s">
						<condition>
							<check_all>
								<check_value value="{object.speed@L0GI04.Leader}" max="0"/>
								<check_value value="{object.sector@L0GI04.Leader}" exact="{player.sector}"/>
								<check_distance value="{object.distance@L0GI04.Leader}" max="5km"/>
								<check_value value="{value@L0GI04.LeaderWait}" exact="0"/>
								<check_value value="{value@L0GI04.AttackPhase}" exact="0"/>
								<check_value value="{value@L0GI04.LeaderStopped}" exact="0"/>
							</check_all>							
						</condition>
						<action>
							<do_all>
								<do_if value="{value@L0GI04.Status}" list="2|8">
									<set_value name="L0GI04.NodeX" exact="{object.position.x.m@L0GI04.Leader}"/>
									<set_value name="L0GI04.NodeY" exact="{object.position.y.m@L0GI04.Leader}"/>
									<set_value name="L0GI04.NodeZ" exact="{object.position.z.m@L0GI04.Leader}"/>
								</do_if>
							</do_all>
						</action>
						<cues>
							<cue name="L0GI04 ResetLeaderCheck">
								<condition>
									<cue_is_complete cue="L0GI04 LeaderStopped"/>
								</condition>
								<timing>
									<time min="10s" max="15s"/>
								</timing>
								<action>
									<reset_cue cue="L0GI04 LeaderStopped"/>
								</action>
							</cue>
						</cues>
					</cue>
			        <cue name="L0GI04 LeaderToNode" delay="5s">
				        <condition>
							<check_all>
								<check_value value="{value@L0GI04.AttackPhase}" exact="0"/>
								<object_position object="{object@L0GI04.Leader}" max="7km">
									<position x="{value@L0GI04.NodeX}m" y="{value@L0GI04.NodeY}m" z="{value@L0GI04.NodeZ}m"/>
								</object_position>
							</check_all>
						</condition>
				        <action>
							<do_all>
								<set_value name="L0GI04.NodesRemaining" exact="1" operation="subtract"/>
								<do_choose>
									<do_when value="{value@L0GI04.NodesRemaining}" min="1">
										<set_value name="this.Random" min="1" max="100"/>
										<set_value name="this.RandomPosition" exact="0"/>
										<do_if value="{value@this.Random}" max="10">
											<find_station name="this.RandomPosition">
												<sector sector="{object.sector@L0GI04.Leader}"/>
												<jumps exact="0"/>
											</find_station>
										</do_if>
										<do_if value="{object.exists@this.RandomPosition}" exact="0">
											<do_if value="{value@this.Random}" max="50">
												<find_gate name="this.RandomPosition">
	    											<sector sector="{object.sector@L0GI04.Leader}"/>
    												<jumps exact="0"/>
												</find_gate>
											</do_if>
										</do_if>

										<do_if value="{object.exists@this.RandomPosition}" exact="1">
											<do_if value="{object.exists@L0GI04.LastDestination}" exact="1">
											    <do_if value="{object@this.RandomPosition}" exact="{object@L0GI04.LastDestination}">												
												    <set_value name="this.RandomPosition" exact="0" />
											    </do_if>
											</do_if>
										</do_if>
											
										<do_choose>
											<do_when value="{object.exists@this.RandomPosition}" exact="1">
												<set_object name="L0GI04.LastDestination" value="{object@this.RandomPosition}"/>
												<set_value name="this.Random" min="1" max="100"/>
												<set_value name="L0GI04.NodeX" exact="{object.position.x.m@this.RandomPosition}"/>
												<set_value name="L0GI04.NodeZ" exact="{object.position.z.m@this.RandomPosition}"/>
												<do_choose>
													<do_when value="{value@this.Random}" max="50">
														<set_value name="L0GI04.NodeY" exact="{object.position.y.m@this.RandomPosition}+8000"/>
													</do_when>
													<do_otherwise>
														<set_value name="L0GI04.NodeY" exact="{object.position.y.m@this.RandomPosition}-8000"/>
													</do_otherwise>
												</do_choose>
											</do_when>
											<do_otherwise>
												<set_value name="L0GI04.NodeX" min="-{object.sector.size.m@L0GI04.Leader}" max="{object.sector.size.m@L0GI04.Leader}"/>
												<set_value name="L0GI04.NodeY" min="-5000" max="5000"/>
												<set_value name="L0GI04.NodeZ" min="-{object.sector.size.m@L0GI04.Leader}" max="{object.sector.size.m@L0GI04.Leader}"/>
												<remove_object object="L0GI04.LastDestination"/>
											</do_otherwise>
										</do_choose>

										<do_if value="{value@L0GI04.Status}" exact="8">
											<do_if value="{value@L0GI04.ResetOBSPerSector}" exact="1">
												<set_value name="L0GI04.OBSTime" exact="{value@L0GI04.OBSDelay}+{player.age}"/>
												<reset_cue cue="L0GI04 OBS Time"/>
												<reset_cue cue="L0GI04 OBS"/>
											</do_if>
										</do_if>

										<set_value name="L0GI04.Status" exact="2"/>
										<set_command object="{object@L0GI04.Leader}" command="moveposition">
											<position x="{value@L0GI04.NodeX}m" y="{value@L0GI04.NodeY}m" z="{value@L0GI04.NodeZ}m" />
											<sector sector="{sector@L0GI04.PatrolSector}"/>
										</set_command>
										<reset_cue cue="L0GI04 LeaderToNode"/>
									</do_when>
									<do_otherwise>
										<do_choose>
											<do_when value="{object.sector@L0GI04.Leader}" exact="{sector@{param@FinalSector}}">
   												<set_value name="L0GI04.Status" exact="6"/>
												<set_value name="{param@FeedbackName}" exact="1"/>
												<cancel_cue cue="L0GI04"/>
											</do_when>
											<do_otherwise>
												<do_if value="{value@L0GI04.Status}" exact="8">
													<do_if value="{value@L0GI04.ResetOBSPerSector}" exact="1">
														<set_value name="L0GI04.OBSTime" exact="{value@L0GI04.OBSDelay}+{player.age}"/>
														<reset_cue cue="L0GI04 OBS Time"/>
														<reset_cue cue="L0GI04 OBS"/>
													</do_if>
												</do_if>
												<set_value name="L0GI04.Status" exact="3"/>
												<do_if value="{sector.route.exists@{param@FinalSector}}" exact="1">
													<set_sector name="L0GI04.NextSector" value="{sector.route.destination.sector@{param@FinalSector}}"/>
													<set_command object="{object@L0GI04.Leader}" command="movesector">
														<sector sector="{sector@L0GI04.NextSector}"/>
													</set_command>
												</do_if>
											</do_otherwise>
										</do_choose>
									</do_otherwise>
								</do_choose>
							</do_all>
				        </action>
						<cues>
							<cue name="L0GI04 CloseToGate">
								<condition>
									<check_all>
										<check_value value="{value@L0GI04.AttackPhase}" exact="0"/>
										<check_value value="{value@L0GI04.Status}" exact="3"/>
							            <object_position object="{object@L0GI04.Leader}" max="14km">
								            <position object="{sector.route@{sector@L0GI04.NextSector}}"/>
							            </object_position>										 
									</check_all>
								</condition>
								<action>
									<set_value name="L0GI04.Status" exact="4"/>
								</action>
							</cue>
							<cue name="L0GI04 CloseToGate2">
								<condition>
									<check_all>
										<check_value value="{value@L0GI04.AttackPhase}" exact="0"/>
										<check_value value="{value@L0GI04.Status}" exact="4"/>
							            <object_position object="{object@L0GI04.Leader}" max="7km">
								            <position object="{sector.route@{sector@L0GI04.NextSector}}"/>
							            </object_position>										 
									</check_all>
								</condition>
								<action>
									<do_all>
										<do_if value="{value@L0GI04.LeaderTalk}" exact="1">
											<play_text actor="{actor@L0GI04.LeaderActor}" textid="993" priority="60"/>
										</do_if>
										<set_value name="L0GI04.Status" exact="5"/>
									</do_all>
								</action>
							</cue>
						    <cue name="L0GI04 NextSector" delay="1s">
								<condition>
									<check_all>
										<check_value value="{sector.exists@L0GI04.NextSector}" exact="1"/>
										<check_value value="{value@L0GI04.NodesRemaining}" exact="0"/>
										<check_value value="{object.sector@L0GI04.Leader}" exact="{sector@L0GI04.NextSector}"/>
									</check_all>
								</condition>
								<action>
									<do_all>
										<do_if value="{object.sector@L0GI04.Leader}" exact="{sector@{param@FinalSector}}">
											<do_if value="{param@PatrolDest}" exact="0">
    											<set_value name="L0GI04.Status" exact="6"/>
											</do_if>
										</do_if>										

	    								<set_sector name="L0GI04.PatrolSector" value="{object.sector@L0GI04.Leader}"/>
										<set_value name="{param@OBS Counter} {sector@L0GI04.PatrolSector}" exact="0"/>
										<remove_sector sector="L0GI04.NextSector"/>
										
										<do_if value="{value@L0GI04.Status}" exact="6" negate="1">
				    						<set_value name="L0GI04.Status" exact="1"/>
			    							<set_value name="L0GI04.NodesRemaining" exact="-1"/>
    										<reset_cue cue="L0GI04 LeaderInSector"/>
									    </do_if>
										<reset_cue cue="L0GI04 SectorIgnore"/>
										<reset_cue cue="L0GI04 LeaderWait"/>
									</do_all>									
								</action>
							</cue>
						</cues>
			        </cue>
				</cues>
			</cue>

			<cue name="L0GI04 PlayerWrongSector">
				<condition>
					<check_value value="{player.sector}" exact="{object.sector@L0GI04.Leader}" negate="1"/>
				</condition>
				<action>
					<do_all>
						<create_briefing cue="{param@Cue}">
							<objectives>
								<objective step="{param@Step}">
									<flyto>
										<sector sector="{object.sector@L0GI04.Leader}"/>
									</flyto>
								</objective>
							</objectives>
						</create_briefing>
						<set_objective cue="{param@Cue}">
							<flyto>
								<sector sector="{object.sector@L0GI04.Leader}"/>
							</flyto>
						</set_objective>
						<do_choose>
							<do_when value="{value@L0GI04.MaxLeaveTime}" min="1">
								<set_value name="L0GI04 WaitTime" exact="{player.age}+({value@L0GI04.MaxLeaveTime}/2)"/>								
								<create_briefing cue="{param@Cue}">
									<timer start="{player.age}" duration="{value@L0GI04.MaxLeaveTime}"/>
								</create_briefing>
								<set_objective cue="{param@Cue}">
									<timer start="{player.age}" duration="{value@L0GI04.MaxLeaveTime}"/>
								</set_objective>
							</do_when>
							<do_otherwise>
								<set_value name="L0GI04 WaitTime" exact="0"/>
							</do_otherwise>
						</do_choose>
					</do_all>
				</action>
				<cues>
					<cue name="L0GI04 LeaveSectorTimer">
						<condition>
							<check_all>
								<check_value value="{value@L0GI04 WaitTime}" min="1"/>
								<check_age min="{value@L0GI04 WaitTime}"/>
							</check_all>
						</condition>
						<action>
							<do_all>
								<play_text actor="{actor@L0GI04.LeaderActor}" textid="848" priority="60"/>
								<set_value name="L0GI04 WaitTime" exact="{player.age}+({value@L0GI04.MaxLeaveTime}/2)"/>
							</do_all>
						</action>
						<cues>
							<cue name="L0GI04 LeaveSectorTimer2">
								<condition>
									<check_all>
										<cue_is_complete cue="L0GI04 LeaveSectorTimer"/>
										<check_value value="{value@L0GI04 WaitTime}" min="1"/>
										<check_age min="{value@L0GI04 WaitTime}"/>
									</check_all>
								</condition>
								<action>
									<do_all>
										<set_value name="{param@FeedbackName}" exact="4"/>
										<cancel_cue cue="L0GI04"/>
									</do_all>
								</action>
							</cue>
						</cues>
					</cue>
					<cue name="L0GI04 PlayerReachedSector">
						<condition>
							<check_value value="{player.sector}" exact="{object.sector@L0GI04.Leader}"/>
						</condition>
						<cues>
							<cue name="L0GI04 IsInSector">
								<condition>
									<cue_is_complete cue="L0GI04 PlayerReachedSector"/>
								</condition>
								<action>
									<do_all>
										<create_briefing cue="{param@Cue}">
											<timer duration="0"/>
										</create_briefing>
										<set_objective cue="{param@Cue}">
											<timer duration="0"/>
										</set_objective>
										<do_if value="{value@L0GI04.LeaderTalk}" exact="1">
											<play_text actor="{actor@L0GI04.LeaderActor}" textid="921" priority="60" />
										</do_if>
										<reset_cue cue="L0GI04 UpdateBreifing"/>
										<cancel_cue cue="L0GI04 LeaveSectorTimer"/>
										<cancel_cue cue="L0GI04 LeaveSectorTimer2"/>
									</do_all>
								</action>
								<cues>									
                                    <cue name="L0GI04 Set Enemy Races" check="cancel">
                                        <condition>
                                            <check_value value="{value@L0GI04.EnemyRace}" exact="0"/>
                                        </condition>
                                        <action>
							                <do_all>
												<do_choose>
                                                    <do_when value="{param@Use Offer Race Enemies}" exact="1">
                                                        <set_value name="this.Race" exact="{param@OfferRace}"/>
                                                    </do_when>
                                                    <do_otherwise>
                                                        <set_value name="this.Race" exact="{sector.race@L0GI04.PatrolSector}"/>
                                                    </do_otherwise>
                                                </do_choose>
							        
						                        <set_value name="L0GI04.EnemyRace" exact="{lookup.race.randomenemy@this.Race}"/>
							                    <do_if value="{value@L0GI04.EnemyRace}" exact="0">
                                                    <set_value name="L0GI04.EnemyRace" exact="{lookup.race.mask@aggressive}"/>
								                </do_if>
						                    </do_all>
                                        </action>
                                    </cue>									
									<cue name="L0GI04 ResetPlayerCheck">
										<timing>
											<time exact="10s"/>
										</timing>
										<action>
											<do_all>
											    <do_choose>
												    <do_when value="{value@L0GI04.Status}" exact="6">
                                                        <set_value name="{param@FeedbackName}" exact="1"/>
                                                        <cancel_cue cue="L0GI04"/>
												    </do_when>
											        <do_otherwise>
        											    <reset_cue cue="L0GI04 PlayerWrongSector"/>
												    </do_otherwise>
											    </do_choose>
											</do_all>
										</action>
									</cue>
								</cues>
							</cue>
						</cues>
					</cue>
				</cues>
			</cue>
			
			<cue name="L0GI04 Guidance Update Check" delay="2s" version="2" instantiate="static">
				<condition>
					<check_all>
						<check_value value="{value@L0GI04.AttackPhase}" exact="1"/>
						<check_value value="{value@L0GI04.EnemyRace}" exact="0" negate="1"/>
						<check_value value="{player.sector}" exact="{sector@L0GI04.PatrolSector}"/>
						<check_value value="{group.object.count@{param@OBS Cue}.Enemies}" max="0"/>
						<check_any>
							<object_exists object="L0GI04.GuidanceObject" negate="1"/>
							<object_is_docked object="L0GI04.GuidanceObject"/>
							<check_value value="{object.sector@L0GI04.GuidanceObject}" exact="{object.sector@L0GI04.Leader}"/>
						</check_any>
						<count_ships race="{value@L0GI04.EnemyRace}" enemy="1" min="1" negate="1">
							<distance max="30km"/>
						</count_ships>
					</check_all>
				</condition>
				<action>
					<do_all>
						<do_choose>
							<do_when value="{value@L0GI04.Status}" list="2|8">
								<set_command object="{object@L0GI04.Leader}" command="moveposition">
									<position x="{value@L0GI04.NodeX}m" y="{value@L0GI04.NodeY}m" z="{value@L0GI04.NodeZ}m" min="0km" max="2km"/>
									<sector sector="{sector@L0GI04.PatrolSector}"/>
								</set_command>
							</do_when>
							<do_when value="{value@L0GI04.Status}" list="3|4|5">
								<set_command object="{object@L0GI04.Leader}" command="movesector">
									<sector sector="{sector@L0GI04.NextSector}"/>
								</set_command>
							</do_when>
						</do_choose>
						<do_if value="{param.exists@Followers}">
							<set_group_command group="{param@Followers}" command="protect" commandobject="{object@L0GI04.Leader}"/>
						</do_if>
						<do_if value="{value@L0GI04.LeaderTalk}" exact="1">
							<play_text actor="{actor@L0GI04.LeaderActor}" textid="992" priority="60" />
						</do_if>
						<set_value name="L0GI04.AttackPhase" exact="3"/>
						<set_relation object="L0GI04.Leader">
							<relation relation="friend" mutual="1"/>
						</set_relation>
						<reset_cue cue="L0GI04 UpdateBreifing"/>
					</do_all>
				</action>
				<cues>
					<cue name="L0GI04 Guidance Reset">
						<timing>
							<time exact="20s"/>
						</timing>
						<action>
							<do_all>
								<do_if value="{value@L0GI04.AttackPhase}" exact="3">
									<set_value name="L0GI04.AttackPhase" exact="0"/>
									<set_value name="L0GI04.LeaderStopped" exact="0"/>
									<reset_cue cue="L0GI04 LeaderTooFar"/>
								</do_if>
							</do_all>
						</action>
					</cue>
				</cues>
			</cue>
			
			<cue name="L0GI04 Guidance Update" delay="2s" instantiate="static" version="2">
				<condition>
					<check_all>
						<check_value value="{value@L0GI04.Status}" list="2|3|4|8"/>
						<check_value value="{value@L0GI04.EnemyRace}" exact="0" negate="1"/>
						<check_value value="{player.sector}" exact="{object.sector@L0GI04.Leader}"/>
						<check_any>
							<object_exists object="L0GI04.GuidanceObject" negate="1"/>
							<object_is_docked object="L0GI04.GuidanceObject"/>
							<check_value value="{object.sector@L0GI04.GuidanceObject}" exact="{object.sector@L0GI04.Leader}"/>
							<!--
							<count_ships race="{value@L0GI04.EnemyRace}" enemy="1" min="1" >
								<distance max="{object.distance@L0GI04.GuidanceObject}-10m"/>
							</count_ships>
							-->
						</check_any>
						<count_ships race="{value@L0GI04.EnemyRace}" enemy="1" min="1">
							<distance max="30km"/>
						</count_ships>
					</check_all>
				</condition>
				<action>
					<do_all>
						<find_ship race="{value@L0GI04.EnemyRace}" nearest="1" name="L0GI04.GuidanceObject" enemy="1" silent="1"/>
						<do_if value="{object.exists@L0GI04.GuidanceObject}" exact="0">
						    <find_ship race="{value@L0GI04.EnemyRace}" nearest="1" name="L0GI04.GuidanceObject" silent="1"/>
						</do_if>
						<do_if value="{object.exists@L0GI04.GuidanceObject}" exact="1">
							<set_relation object="L0GI04.GuidanceObject">
								<relation relation="enemy" mutual="1"/>
								<relation object="L0GI04.Leader" relation="enemy" mutual="1"/>
							</set_relation>
							<do_if value="{param.exists@Followers}">
								<set_relation object="L0GI04.GuidanceObject">
									<relation group="{param@Followers}" relation="enemy" mutual="1"/>
								</set_relation>
							</do_if>
						</do_if>
						
						<create_briefing cue="{param@Cue}">
							<objectives>
								<objective step="{param@Step}">
									<destroy object="L0GI04.GuidanceObject"/>
								</objective>
							</objectives>
						</create_briefing>
						<do_choose>
							<do_when value="{value@L0GI04.AttackPhase}" list="1|3">
								<set_objective cue="{param@Cue}" silent="1">
									<briefing cue="{param@Cue}" step="{param@Step}"/>
									<destroy object="L0GI04.GuidanceObject"/>
								</set_objective>
							</do_when>
							<do_otherwise>
								<set_objective cue="{param@Cue}">
									<briefing cue="{param@Cue}" step="{param@Step}"/>
									<destroy object="L0GI04.GuidanceObject"/>
								</set_objective>
								<do_if value="{value@L0GI04.AttackPhase}" exact="2" negate="1">
									<do_if value="{value@L0GI04.LeaderTalk}" exact="1">
								        <play_text actor="{actor@L0GI04.LeaderActor}" textid="500" priority="60"/>
								    </do_if>
								</do_if>
							</do_otherwise>
						</do_choose>
						<set_value name="L0GI04.AttackPhase" exact="1"/>
						<do_if value="{object.exists@L0GI04.GuidanceObject}" exact="1">
							<set_command object="L0GI04.Leader" command="attack" commandobject="{object@L0GI04.GuidanceObject}"/>
							<start_script script="plugin.guilds.utils">
								<scriptargs>
									<scriptvalue datatype="string" datavalue="checkenv"/>
									<scriptvalue datatype="ship" datavalue="{object@L0GI04.GuidanceObject}"/>
									<scriptvalue datatype="integer" datavalue="1000"/>
								</scriptargs>
							</start_script>
						</do_if>
		                <do_if value="{param.exists@Followers}">
						    <set_group_command group="{param@Followers}" command="killenemies"/>						
						</do_if>							
					    <reset_cue cue="L0GI04 LeaderTooFar"/>
					</do_all>
				</action>
			</cue>

			<cue name="L0GI04 Leader Kills Object" instantiate="static" version="5">
				<condition>
					<check_all>
						<check_value value="{object.exists@L0GI04.GuidanceObject}" exact="1"/>
						<object_destroyed object="{object@L0GI04.GuidanceObject}" param2="{object@L0GI04.Leader}"/>
					    <check_value value="{value@L0GI04.LeaderTalk}" exact="1"/>
					</check_all>
				</condition>
			    <action>
					<do_any>
			            <play_text actor="{actor@L0GI04.LeaderActor}" textid="535" priority="60"/>
			            <play_text actor="{actor@L0GI04.LeaderActor}" textid="536" priority="60"/>
			            <play_text actor="{actor@L0GI04.LeaderActor}" textid="537" priority="60"/>
					</do_any>
				</action>
			</cue>
				
			<cue name="L0GI04 Player Kills Object" instantiate="static" version="5">
				<condition>
					<check_any>
						<player_killed_object/>
						<player_owned_killed_object/>
					</check_any>
				</condition>
				<action>
					<do_if value="{player.sector}" exact="{sector@L0GI04.PatrolSector}">
						<do_if value="{object.race.mask.{value@L0GI04.EnemyRace}@{event.object}}" exact="1">
							<set_value name="this.GoodKill" exact="1"/>
						</do_if>

						<do_if value="{value@this.GoodKill}" exact="1">
							<set_value name="{param@KillCount Name}" operation="add"/>
							<set_value name="{param@KillScore Name}" operation="add" exact="{value@Constant {object.class@{event.object}} Points}"/>
							<set_value name="this.increase" exact="{value@Constant {object.class@{event.object}} Points}*{value@L0GI04.Bonus}"/>
							<do_if value="{value@this.increase}" exact="0">
								<set_value name="this.increase" min="{value@Constant {lookup.class@m4} Points}*{value@L0GI04.Bonus}" max="{value@Constant {lookup.class@m4} Points}*{value@L0GI04.Bonus}+100"/>
							</do_if>
							<set_value name="{param@Bonus}" operation="add" exact="{value@this.increase}"/>

							<do_if value="{param.exists@RewardCr}" exact="1">
								<set_objective cue="{param@Cue}">
									<custom action="{35,1104065}" text="+ [o]{value.formatted@this.increase}[/o] Cr" icon="destroy"/>
								</set_objective>
							</do_if>

							<set_objective cue="{param@Cue}" silent="1">
								<custom action="{35,2052}" text="{sector.name@L0GI04.PatrolSector}" icon="destroy"/>
							</set_objective>
						</do_if>
					</do_if>
				</action>				
				<cues>
					<cue ref="L0GI04 Complete Rewards"/>
				</cues>
			</cue>

			<cue name="L0GI04 Guidance Object Captured" instantiate="static">
				<condition>
					<object_captured object="L0GI04.GuidanceObject"/>
				</condition>
				<action>
					<do_all>
						<remove_object object="L0GI04.GuidanceObject"/>
					</do_all>
				</action>
			</cue>

			<cue name="L0GI04 Complete Rewards" library="1" version="2" comment="V2: 06/10/2008. Added formatted variable to bonus value">
                <action>
                    <do_if value="{param.exists@RewardCr}" exact="1">
                        <do_choose>
                            <do_when value="{param.exists@RewardFree}" exact="1">
                                <create_briefing cue="{param@Cue}" >
                                    <reward money="{value@{param@RewardCr}}" other="+ [o]{value.formatted@{param@Bonus}}[/o] {35,707} + {param@RewardFree}"/>
                                </create_briefing>
                                <set_objective cue="{param@Cue}" silent="1">
                                    <reward money="{value@{param@RewardCr}}" other="+ [o]{value.formatted@{param@Bonus}}[/o] {35,707} + {param@RewardFree}"/>
                                </set_objective>
                            </do_when>
                            <do_when value="{object.exists@{param@RewardObj}}" exact="1">
                                <create_briefing cue="{param@Cue}">
                                    <reward money="{value@{param@RewardCr}}" other="+ [o]{value.formatted@{param@Bonus}}[/o] {35,707} + {object.name@{param@RewardObj}}"/>
                                </create_briefing>
                                <set_objective cue="{param@Cue}" silent="1">
                                    <reward money="{value@{param@RewardCr}}" other="+ [o]{value.formatted@{param@Bonus}}[/o] {35,707} + {object.name@{param@RewardObj}}"/>
                                </set_objective>
                            </do_when>
                            <do_when value="{param.exists@RewardWare}" exact="1">
                                <create_briefing cue="{param@Cue}">
                                    <reward money="{value@{param@RewardCr}}" other="+ [o]{value.formatted@{param@Bonus}}[/o] {35,707} + {lookup.type.name@{param@RewardWare}}"/>
                                </create_briefing>
                                <set_objective cue="{param@Cue}" silent="1">
                                    <reward money="{value@{param@RewardCr}}" other="+ [o]{value.formatted@{param@Bonus}}[/o] {35,707} + {lookup.type.name@{param@RewardWare}}"/>
                                </set_objective>
                                <do_if value="{param.exists@RewardAmt}" exact="1">
                                    <create_briefing cue="{param@Cue}">
                                        <reward money="{value@{param@RewardCr}}" other="+ [o]{value.formatted@{param@Bonus}}[/o] {35,707} + {value@{param@RewardAmt}} x {lookup.type.name@{param@RewardWare}}"/>
                                    </create_briefing>
                                    <set_objective cue="{param@Cue}" silent="1">
                                        <reward money="{value@{param@RewardCr}}" other="+ [o]{value.formatted@{param@Bonus}}[/o] {35,707} + {value@{param@RewardAmt}} x {lookup.type.name@{param@RewardWare}}"/>
                                    </set_objective>
                                </do_if>
                            </do_when>
                            <do_otherwise>
                                <create_briefing cue="{param@Cue}">
                                    <reward money="{value@{param@RewardCr}}" other="+ [o]{value.formatted@{param@Bonus}}[/o] {35,707}"/>
                                </create_briefing>
                                <set_objective cue="{param@Cue}" silent="1">
                                    <reward money="{value@{param@RewardCr}}" other="+ [o]{value.formatted@{param@Bonus}}[/o] {35,707}"/>
                                </set_objective>
                            </do_otherwise>
                        </do_choose>
                    </do_if>
                </action>
            </cue>

			<cue name="L0GI04 OBS" check="cancel">
                <condition>					
                    <check_value value="{param@OBS}" exact="1"/>
                </condition>
                <cues>
					<cue name="L0GI04 OBS Check Environment" delay="1s" instantiate="static">
						<condition>
							<check_all>
								<check_value value="{group.object.count@{param@OBS Cue}.Enemies}" min="1"/>
							</check_all>
						</condition>
						<action>
							<do_all counter="Count" exact="{group.object.count@{param@OBS Cue}.Enemies}">
								<set_object name="this.ship" value="{group.object.{counter@Count}@{param@OBS Cue}.Enemies}"/>
								<start_script script="plugin.guilds.utils">
									<scriptargs>
										<scriptvalue datatype="string" datavalue="checkenv"/>
										<scriptvalue datatype="ship" datavalue="{object@this.ship}"/>
									</scriptargs>
								</start_script>
							</do_all>
						</action>
					</cue>
					<cue name="L0GI04 OBS Enemies Killed" delay="1s" instantiate="static">
						<condition>
							<check_any>
								<any_object_destroyed group="{param@OBS Cue}.Enemies"/>
								<any_object_captured group="{param@OBS Cue}.Enemies"/>
							</check_any>
						</condition>
						<action>
							<do_all>
							<remove_object_from_group object="{event.object}" group="{param@OBS Cue}.Enemies"/>
								<do_if value="{group.object.count@{param@OBS Cue}.Enemies}" max="0">
									<remove_group group="{param@OBS Cue}.Enemies"/>
								</do_if>
							</do_all>
						</action>
					</cue>
					<cue name="L0GI04 OBS CloseToLeader" delay="2s" instantiate="static">
						<condition>
							<check_all>
								<check_value value="{group.object.count@{param@OBS Cue}.Enemies}" min="1"/>
								<check_value value="{group.object.random.sector@{param@OBS Cue}.Enemies}" exact="{object.sector@L0GI04.Leader}"/>
								<any_object_position group="{param@OBS Cue}.Enemies" max="20km">
									<position object="{object@L0GI04.Leader}"/>
									<sector sector="{object.sector@L0GI04.Leader}"/>
								</any_object_position>
							</check_all>
						</condition>
						<action>
							<do_all>
								<set_group_command group="{param@OBS Cue}.Enemies" command="killenemies"/>
								<remove_group group="{param@OBS Cue}.Enemies"/>
							</do_all>
						</action>
					</cue>

					<cue name="L0GI04 OBS Time" delay="5s">
                        <condition>
                            <check_age min="{value@L0GI04.OBSTime}"/>
                        </condition>
						<timing>
							<time exact="1s"/>
						</timing>
                        <cues>
                            <cue name="L0GI04 Check OBS Count" delay="1s">
                                <condition>
									<check_all>
										<cue_is_complete cue="L0GI04 OBS Time"/>
                						<check_value value="{value@L0GI04.Status}" list="2|3|4"/>
										<check_value value="{player.sector}" exact="{object.sector@L0GI04.Leader}"/>
										<check_any>
											<check_value value="{value@{param@OBS Counter} {object.sector@L0GI04.Leader}}" max="{value@L0GI04.MaxOBSPerSector}-1"/>
											<check_value value="{value@L0GI04.MaxOBSPerSector}" max="0"/>
										</check_any>
										<check_any>
											<check_value value="{param.exists@OBSSectorIgnoreList}" exact="0"/>
											<check_value value="{value@L0GI04.IgnoreOBS}" exact="0"/>
										</check_any>
                                        <check_any>										
                                            <check_value value="{param@Max OBS Instances}" exact="0"/>
                                            <check_value value="{param@Max OBS Instances}-{value@{param@OBS Counter}}" min="1"/>
                                        </check_any>
									</check_all>
                                </condition>
                                <action>
                                    <do_if value="{player.age}" min="{value@L0GI04.OBSTime}">
                                        <set_value name="this.RunOBS" exact="0"/>
                                        <set_value name="L0GI04.OBSTime" exact="{value@L0GI04.OBSDelay}+{player.age}"/>
                                        <do_choose>
                                            <do_when value="{value@{param@OBS Counter} {sector@L0GI04.PatrolSector}}" min="{value@L0GI04.MaxOBSPerSector}">
												<do_choose>
                                                    <do_when value="{value@L0GI04.MaxOBSPerSector}" exact="0">
                                                        <set_value name="this.RunOBS" exact="1"/>
                                                    </do_when>
                                                    <do_otherwise>
														<cancel_cue cue="L0GI04 ref OBS"/>
                                                        <cancel_cue cue="L0GI04 OBS Set Command"/>
                                                        <reset_cue cue="L0GI04 OBS Time"/>
                                                    </do_otherwise>
                                                </do_choose>
                                            </do_when>
                                            <do_otherwise>
                                                <set_value name="this.RunOBS" exact="1"/>
                                            </do_otherwise>
                                        </do_choose>
                                        <do_if value="{value@this.RunOBS}" exact="1">
                                            <set_value name="L0GI04.OBS X" min="-30" max="30"/>
                                            <set_value name="L0GI04.OBS Y" min="-10" max="10"/>
                                            <set_value name="L0GI04.OBS Z" min="-30" max="30"/>
                                            <find_gate name="L0GI04.OBS StartGate" typename="SS_WG_EAST|SS_WG_NORTH|SS_WG_WEST|SS_WG_SOUTH|SS_WG_T_NORTH|SS_WG_T_SOUTH|SS_WG_T_EAST|SS_WG_T_WEST" nearest="1">
                                                <sector sector="{object.sector@L0GI04.Leader}"/>
                                            </find_gate>
										    <do_if value="{object.exists@L0GI04.OBS StartGate}" exact="1">
												<set_object name="L0GI04.OBS Gate" value="{object.destination@L0GI04.OBS StartGate}"/>
											</do_if>
											<do_choose>
												<do_when value="{object.exists@L0GI04.OBS Gate}" exact="1">
                                                    <set_sector name="L0GI04.OBS Sector" value="{object.sector@L0GI04.OBS Gate}"/>
                                                    <set_value name="L0GI04.OBS Range" exact="0km"/>
												</do_when>
											    <do_otherwise>
                                                    <set_sector name="L0GI04.OBS Sector" value="{object.sector@L0GI04.Leader}"/>
                                                    <set_value name="L0GI04.OBS Range" exact="30km"/>
											    </do_otherwise>
											</do_choose>
                                        </do_if>
                                    </do_if>
                                </action>                  
					            <cues>
									<cue name="L0GI04 ref OBS">
										<cues>
											<cue ref="OBS">
												<params>
													<param name="OBS Cancel Cue" value="L0GI04 ref OBS" comment="The cue which is canceled after the OBS finishes"/>
													<param name="OBS Fleet Group Name" value="Enemies" comment="The group name where all main ships are saved too"/>
													<param name="OBSFleetPilotsRace" value="{value@L0GI04.EnemyRace}"/>
													<param name="OBS Support Fleet Group Name" value="Enemies" comment="The group name where all support ships are saved too"/>
													<param name="OBSPosition" value="{value@L0GI04.OBS Range}" comment="how far away should the OBS ships be from FleetPositionObject"/>
													<param name="OBSSector" value="{sector@L0GI04.OBS Sector}" comment="The sector where the ships will spawn if OBSFleetPositionObject not set"/>
													<param name="OBS X" value="{value@L0GI04.OBS X}"/>
													<param name="OBS Y" value="{value@L0GI04.OBS Y}"/>
													<param name="OBS Z" value="{value@L0GI04.OBS Z}"/>
													<param name="OBS Dock Support" value="0"/>
													<param name="OBSFleetRelation" value="-1"/>
													<param name="OBSFleetPositionObject" value="{object@L0GI04.OBS Gate}"/>
												</params>
											</cue>
										</cues>
									</cue>
									<cue name="L0GI04 OBS Set Command">
										<condition>
											<check_all>
												<cue_is_complete cue="L0GI04 Check OBS Count"/>
												<cue_cancelled cue="L0GI04 ref OBS"/>
											</check_all>
										</condition>
										<timing>
											<time min="2s" max="5s"/>
										</timing>
										<action>
											<do_all>
												<set_value name="{param@OBS Counter} {sector@L0GI04.PatrolSector}" operation="add"/>
												<set_value name="{param@OBS Counter}" operation="add"/>

												<do_if value="{group.object.count@{param@OBS Cue}.Enemies}" min="1">
													<set_group_command group="{param@OBS Cue}.Enemies" command="attack" commandobject="{object@L0GI04.Leader}"/>
													<set_value name="L0GI04.AttackPhase" exact="2"/>
													<do_if value="{param.exists@Followers}">
														<set_group_relation group="{param@OBS Cue}.Enemies">
															<relation group="{param@Followers}" relation="enemy" mutual="1"/>
															<relation object="{object@L0GI04.Leader}" relation="enemy" mutual="1"/>
														</set_group_relation>
													</do_if>													
												</do_if>													
											</do_all>
										</action>
										<cues>
											<cue name="L0GI04 OBS StartAttack">
												<condition>
													<check_all>
														<check_value value="{value@L0GI04.AttackPhase}" exact="2"/>
														<cue_is_complete cue="L0GI04 OBS Set Command"/>
														<check_value value="{group.object.count@{param@OBS Cue}.Enemies}" min="1"/>
														<check_value value="{group.object.random.sector@{param@OBS Cue}.Enemies}" exact="{object.sector@L0GI04.Leader}"/>
													</check_all>
												</condition>
												<timing>
													<time exact="5s"/>
												</timing>
												<action>
													<do_all>
														<reset_cue cue="L0GI04 LeaderTooFar"/>
														<do_if value="{object.exists@{group.nearest@{param@OBS Cue}.Enemies}}" exact="1">
															<set_command object="{object@L0GI04.Leader}" command="attack" commandobject="{object@{group.nearest@{param@OBS Cue}.Enemies}}"/>
														</do_if>

														<do_if value="{object.exists@L0GI04.OBS StartGate}" exact="1">
															<do_if value="{value@L0GI04.LeaderTalk}" exact="1">
																<do_choose>
																	<do_when value="{object.type@L0GI04.OBS StartGate}" list="{lookup.type@SS_WG_NORTH}|{lookup.type@SS_WG_T_NORTH}">
																		<play_text actor="{actor@L0GI04.LeaderActor}" priority="80">
																			<line actor="{actor@L0GI04.LeaderActor}" textid="926"/>
																			<line actor="{actor@L0GI04.LeaderActor}" textid="45"/>
																		</play_text>
																	</do_when>
																	<do_when value="{object.type@L0GI04.OBS StartGate}" list="{lookup.type@SS_WG_SOUTH}|{lookup.type@SS_WG_T_SOUTH}">
																		<play_text actor="{actor@L0GI04.LeaderActor}" priority="80">
																			<line actor="{actor@L0GI04.LeaderActor}" textid="926"/>
																			<line actor="{actor@L0GI04.LeaderActor}" textid="46"/>
																		</play_text>
																	</do_when>
																	<do_when value="{object.type@L0GI04.OBS StartGate}" list="{lookup.type@SS_WG_EAST}|{lookup.type@SS_WG_T_EAST}">
																		<play_text actor="{actor@L0GI04.LeaderActor}" priority="80">
																			<line actor="{actor@L0GI04.LeaderActor}" textid="926"/>
																			<line actor="{actor@L0GI04.LeaderActor}" textid="48"/>
																		</play_text>
																	</do_when>
																	<do_when value="{object.type@L0GI04.OBS StartGate}" list="{lookup.type@SS_WG_WEST}|{lookup.type@SS_WG_T_WEST}">
																		<play_text actor="{actor@L0GI04.LeaderActor}" priority="80">
																			<line actor="{actor@L0GI04.LeaderActor}" textid="926"/>
																			<line actor="{actor@L0GI04.LeaderActor}" textid="47"/>
																		</play_text>
																	</do_when>
																	<do_otherwise>
																		<play_text actor="{actor@L0GI04.LeaderActor}" priority="80">
																			<line actor="{actor@L0GI04.LeaderActor}" textid="937"/>
																		</play_text>
																	</do_otherwise>
																</do_choose>
															</do_if>
														</do_if>
													</do_all>
												</action>
											</cue>
											<cue name="L0GI04 OBS SetAttackPhase">
												<condition>
													<check_value value="{value@L0GI04.AttackPhase}" exact="2"/>
												</condition>
												<timing>
													<time exact="25s"/>
												</timing>
												<action>
													<do_if value="{value@L0GI04.AttackPhase}" exact="2">
														<set_value name="L0GI04.AttackPhase" exact="1"/>
													</do_if>
												</action>
											</cue>
											
											<cue name="L0GI04 Reset OBS">
												<condition>
													<check_all>
														<cue_is_complete cue="L0GI04 OBS StartAttack"/>
														<check_value value="{value@L0GI04.AttackPhase}" exact="2" negate="1"/>
													</check_all>
												</condition>
												<timing>
													<time exact="20s"/>
												</timing>
												<action>
													<do_all>
														<remove_object object="L0GI04.OBS Gate"/>
														<reset_cue cue="L0GI04 OBS Time"/>
													</do_all>
												</action>
											</cue>
										</cues>
									</cue>										
                                </cues>
                            </cue>
                            
							<cue name="L0GI04 Cancel OBS" check="cancel">
                                <condition>
                                    <check_all>
                                        <check_value value="{param@Max OBS Instances}*{param.exists@Max OBS Instances}" min="1"/>
                                        <check_value value="{param@Max OBS Instances}-{value@{param@OBS Counter}}" max="0"/>
                                    </check_all>
                                </condition>
                                <timing>
                                    <time exact="5s"/>
                                </timing>
                                <action>
                                    <cancel_cue cue="L0GI04 OBS" instantiate="static"/>
                                </action>
                            </cue>
                        </cues>
                    </cue>
                </cues>
            </cue>
        </cues>
    </cue>
  </cues>
</director>



