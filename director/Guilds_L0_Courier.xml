<?xml version="1.0" encoding="ISO-8859-1" ?>
<?xml-stylesheet href="director.xsl" type="text/xsl" ?>
<director name="test" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="director.xsd">
    <documentation>
        <author alias="Cycrow"/>
        <content reference="Guild Mission, Level 0, Courier" name="Transport Passenger (Courier)" description="Mission to transport a passenger to multiple destination" />
        <version number="1.0" date="06/12/20023" status="development"/>
    </documentation>
    <cues>
        <cue name="L0GI03 B" library="1">
            <documentation>
                <content name="L0GI03 Courier" reference="XXXT" type="briefing"/>
                <version number="1.0" date="06/12/2023" status="development"/>
                <params>
                    <param name="Cue" type="cuename" compulsory="1" description="The cue where the briefing and objectives are stored"/>
                    <param name="ID" type="number" compulsory="1" description="The mission Id for dealing with mission chains"/>
                    <param name="OfferRace" type="number" compulsory="1" description="Race offering the mission"/>
                    <param name="EnemyRace" type="number" compulsory="1" description="Race of the enemy"/>
					<param name="HasXenon" type="boolean" description="Has xenon attackers?"/>
                    <param name="Lv1Guide" type="actorname" compulsory="1" description="The person offering the mission"/>
                    <param name="PageID" type="number" description="Page ID of mission description"/>
                    <param name="TextID" type="number" description="Text ID of mission description"/>
                    <param name="Reward" description="Reward type"/>
                    <param name="StoryID" type="number" compulsory="0" description="Text ID of the Story title" default="No title"/>
                    <param name="Difficulty" type="number" compulsory="1" description="Difficulty level of mission"/>
                    <param name="Passenger" type="actorname" compulsory="0" description="Transport the already defined passenger"/>
                    <param name="StartObject" type="objectname" compulsory="0" description="A pre defined starting point"/>
                    <param name="Dest" type="objectname" compulsory="0" description="A pre defined ending point"/>
                    <param name="StartRace" type="number" compulsory="0" description="Specify the race to start at" default="Mission OfferRace"/>
                    <param name="DestRace" type="number" compulsory="0" description="Specify the race to end at" default="Mission OfferRace"/>
                    <param name="ShipStart" type="objectname" compulsory="0" description="The ship to start at"/>
                    <param name="ShipDest" type="objectname" compulsory="0" description="The ship to end at"/>
                    <param name="HideDest" type="chance" compulsory="0" description="% chance to hide the destination in the initial briefing"/>
                    <param name="Step" type="number" compulsory="0" description="The step to use if additional objectives are involved"/>
                    <param name="TPNeeded" type="number" compulsory="0" description="% Chance that the npc will require a TP transport"/>
                    <param name="Summary" type="boolean" compulsory="0" description="Used to specify summary objectives in a chain of missions"/>
                </params>
            <returns>
                <return name="{param@Cue}.{param@ID} L0GI03 Progress" type="number" description="1 - Mission Completed"/>
                <return name="{param@Cue}.{param@ID} L0GI03 Progress" type="number" description="2 - Out of time"/>
                <return name="{param@Cue}.{param@ID} L0GI03 Progress" type="number" description="3 - Killed/Enslaved Passenger"/>
                <return name="{param@Cue}.{param@ID} L0GI03 Progress" type="number" description="5 - Player Ejected Pilot"/>
                <return name="{param@Cue}.{param@ID} L0GI03 Progress" type="number" description="92 - Out of time, not started mission"/>
                <return name="{param@Cue}.{param@ID} L0GI03 Progress" type="number" description="93 - Destination destroyed, not started mission"/>
                <return name="{param@Cue}.{param@ID} L0GI03 Progress" type="number" description="99 - Aborted"/>
            </returns>
            <history>
                <change date="06/12/2023" author="Cycrow" description="Re-written from 0.3 Passenger"/>
            </history>
        </documentation>
        <action>
            <do_all>
                <do_choose>
                    <do_when value="{param@Summary}" exact="1">
                        <do_if value="{actor.exists@{param@Passenger}}" exact="1">
                            <set_actor name="{param@Cue}.{param@ID} L0Passenger" value="{actor@{param@Passenger}}"/>
                        </do_if>
                        <do_if value="{actor.exists@{param@Cue}.{param@ID} L0Passenger}" exact="0">
                            <create_actor name="{param@Cue}.{param@ID} L0Passenger" race="{param@OfferRace}" voiceflags="32"/>
                            <set_value name="{param@Cue}.{param@ID} Passenger Created" exact="1"/>
                        </do_if>
                        <create_briefing cue="{param@Cue}">
				            <objectives>
                                <objective step="{param@Step}">
                                    <custom action="{35,2025}" text="{actor.name@{param@Cue}.{param@ID} L0Passenger}"/>
                                </objective>
                            </objectives>
                        </create_briefing>
                        <cancel_cue cue="L0GI03 B"/>
                    </do_when>
                    <do_otherwise>
                        <do_if value="{param.exists@Step}" exact="1">
                            <set_value name="{param@Cue}.{param@ID} L0GI03Step" exact="{param@Step}"/>
                        </do_if>
                        <do_if value="{value@{param@Cue}.{param@ID} L0GI03Step}" min="1" negate="1">
                            <set_value name="{param@Cue}.{param@ID} L0GI03Step" exact="1"/>
                        </do_if>
                        <do_if value="{param.exists@StartObject}" exact="1">
                            <do_if value="{object.exists@{param@StartObject}}" exact="1">
                                <set_object name="L0GI03 B.L0Start" value="{object@{param@StartObject}}"/>
                            </do_if>
                        </do_if>
						<set_value name="{param@Cue}.{param@ID} HasXenon" exact="0"/>
						<do_if value="{param.exists@HasXenon}" exact="1">
							<do_if value="{param@HasXenon}" min="1">
								<set_value name="{param@Cue}.{param@ID} HasXenon" exact="1"/>
								<create_briefing targetrace="xenon"/>
							</do_if>
						</do_if>
						<set_value name="{param@Cue}.{param@ID} TPNeeded" exact="0"/>
						<do_if value="{param.exists@TPNeeded}" exact="1">
							<set_value name="{param@Cue}.{param@ID} TPNeeded" exact="1" chance="{param@TPNeeded}"/>
						</do_if>
						<do_if value="{param.exists@DestRace}" exact="1">
                            <set_value name="L0GI03 B.DestRace" exact="{param@DestRace}"/>
                        </do_if>
                        <do_if value="{param.exists@Passenger}" exact="1">
                            <do_if value="{actor.exists@{param@Passenger}}" exact="1">
                                <set_actor name="{param@Cue}.{param@ID} L0Passenger" value="{actor@{param@Passenger}}"/>
                                <do_if value="{actor.station.exists@{param@Passenger}}" exact="1">
                                    <set_object name="L0GI03 B.L0Start" value="{actor.station@{param@Passenger}}"/>
                                </do_if>
                            </do_if>
                        </do_if>
                    </do_otherwise>
                </do_choose>
            </do_all>
        </action>
        <cues>
		    <cue name="L0GI03 B_CreateDestinations">
			    <action>
				    <do_all>
					    <set_value name="{param@Cue}.{param@ID} L0Destinations" exact="{param@Difficulty}"/>
						<set_value name="{param@Cue}.{param@ID} L0ResetTimes" exact="0"/>
						<set_value name="{param@Cue}.{param@ID} L0Tries" exact="0"/>
					</do_all>				  
			    </action>
			    <cues>
				    <cue name="L0GI03 B_CreateDest">
					    <condition>
							<check_all>
						        <check_value value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" max="{value@{param@Cue}.{param@ID} L0Destinations}-1"/>
								<check_value value="{value@{param@Cue}.{param@ID} L0Tries}" max="100"/>
							</check_all>
					    </condition>
					    <cues>
				            <cue ref="LUM06">
					            <params>
						            <!--perhaps chance of "Start" being set as the original offer station?-->
						            <param name="StartDist" value="0"/>
    						          <param name="DestDist" value="1"/>
	    					          <param name="Start" value="L0GI03 B.L0Start"/>
		    				          <param name="DestRace" value="{value@L0GI03 B.DestRace}"/>
			    			          <param name="Exclude" value="{group@{param@Cue}.{param@ID} L0DestinationGroup}"/>
				    	          </params>
				            </cue>
				            <cue name="L0GI03 B_GetDestination">
					            <condition>
						            <cue_completed cue="LUM06 Finished"/>
    					        </condition>
	    				        <action>
		    				        <do_all>
										<set_value name="{param@Cue}.{param@ID} L0Tries" operation="add" exact="1"/>
										<do_if value="{value@{param@Cue}.{param@ID} L0ResetTimes}" max="10">
											<do_if value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" min="1">
												<do_if value="{object@{param@Cue}.{param@ID} L0Dest}" exact="{group.object.{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}@{param@Cue}.{param@ID} L0DestinationGroup}">
													<set_value name="{param@Cue}.{param@ID} L0Dest" exact="0"/>
												</do_if>
											</do_if>
										</do_if>
										<do_choose>
											<do_when value="{object.exists@{param@Cue}.{param@ID} L0Dest}" exact="1">
												<set_value name="{param@Cue}.{param@ID} L0ResetTimes" exact="0"/>
												<set_object name="{param@Cue}.{param@ID} L0Dest{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" value="{param@Cue}.{param@ID} L0Dest" group="{param@Cue}.{param@ID} L0DestinationGroup"/>
												<do_if value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" max="{value@{param@Cue}.{param@ID} L0Destinations}-1">
													<reset_cue cue="L0GI03 B_CreateDest"/>
												</do_if>
											</do_when>
											<do_otherwise>
												<set_value name="{param@Cue}.{param@ID} L0ResetTimes" operation="add" exact="1"/>
												<reset_cue cue="L0GI03 B_CreateDest"/>
											</do_otherwise>
										</do_choose>
						            </do_all>
					            </action>
				            </cue>
					    </cues>
				    </cue>
		            <cue name="L0GI03 Create Briefing" version="1">
                    <condition>
						<check_any>
			                <check_value value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" exact="{value@{param@Cue}.{param@ID} L0Destinations}"/>
							<check_value value="{value@{param@Cue}.{param@ID} L0Tries}" min="100"/>
						</check_any>
                    </condition>
                    <action>
                        <do_all>
				            <!--set timer-->
				            <set_value name="this.startTime" min="({object.distance@{param@Cue}.{param@ID} L0Start}/(100*500))*4" max="({object.distance@{param@Cue}.{param@ID} L0Start}/(100*500))*6" comment="Set time between 4 and 6 times the time needed"/>
							<set_value name="this.TotalDistance" exact="50000000" comment="additional 100km allowance"/>
							<do_all counter="count" exact="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}">
								<set_object name="this.Temp" value="{group.object.{counter@count}@{param@Cue}.{param@ID} L0DestinationGroup}" />
								<set_value name="this.TotalDistance" exact="{object.sector.distance@this.Temp}" operation="add"/>
							</do_all>

							<set_value name="this.ShipSpeed" min="40" max="60"/>
							<do_if value="{param.exists@Difficulty}" exact="1">
								<set_value name="this.ShipSpeed" operation="multiply" exact="{param@Difficulty}" comment="Set ship speed based on difficulty"/>
							</do_if>
							<set_value name="{param@Cue}.{param@ID} L0Time" exact="({value@this.TotalDistance}/({value@this.ShipSpeed}*500))" comment="Set time best on total distance and ship speed"/>
							<set_value name="{param@Cue}.{param@ID} L0Time" operation="add" exact="600" comment="additional 10 mins"/>
                            <do_if value="{value@this.startTime}" min="{value@{param@Cue}.{param@ID} L0Time}+1">
                                <set_value name="{param@Cue}.{param@ID} L0Time" exact="{value@this.startTime}"/>
                            </do_if>
							<!-- minimum time incase its too low -->
                            <do_if value="{value@{param@Cue}.{param@ID} L0Time}" max="300*{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}">
                                <set_value name="{param@Cue}.{param@ID} L0Time" min="300*{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" max="420*{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}"/>
                            </do_if>
                            <do_choose>
                                <do_when value="{actor.exists@{param@Cue}.{param@ID} L0Passenger}" exact="1">
                                    <do_if value="{object@{param@Cue}.{param@ID} L0Start}" exact="{actor.station@{param@Cue}.{param@ID} L0Passenger}" negate="1">
                                        <do_choose>
                                            <do_when value="{object.isclass.hugeship@{param@Cue}.{param@ID} L0Start}" exact="1">
                                                <set_actor_location actor="{param@Cue}.{param@ID} L0Passenger" object="{param@Cue}.{param@ID} L0Start" location="crew"/>
                                            </do_when>
                                            <do_when value="{object.isclass.ship@{param@Cue}.{param@ID} L0Start}" exact="1">
                                                <set_actor_location actor="{param@Cue}.{param@ID} L0Passenger" object="{param@Cue}.{param@ID} L0Start" location="passenger"/>
                                            </do_when>
                                            <do_otherwise>
                                                <!--does this matter for a station, etc?-->
                                                <set_actor_location actor="{param@Cue}.{param@ID} L0Passenger" object="{param@Cue}.{param@ID} L0Start" location="crew"/>
                                            </do_otherwise>
                                        </do_choose>
                                    </do_if>
                                </do_when>
                                <do_otherwise>
                                    <do_choose>
                                        <do_when value="{object.isclass.hugeship@{param@Cue}.{param@ID} L0Start}" exact="1">
                                            <create_actor name="{param@Cue}.{param@ID} L0Passenger" race="{param@OfferRace}" voiceflags="32" object="{param@Cue}.{param@ID} L0Start" location="crew"/>
                                            <set_value name="{param@Cue}.{param@ID} Passenger Created" exact="1"/>
                                        </do_when>
                                        <do_when value="{object.isclass.ship@{param@Cue}.{param@ID} L0Start}" exact="1">
                                            <create_actor name="{param@Cue}.{param@ID} L0Passenger" race="{param@OfferRace}" voiceflags="32" object="{param@Cue}.{param@ID} L0Start" location="passenger"/>
                                            <set_value name="{param@Cue}.{param@ID} Passenger Created" exact="1"/>
                                        </do_when>
                                        <do_otherwise>
                                            <!--does this matter for a station, etc?-->
                                            <create_actor name="{param@Cue}.{param@ID} L0Passenger" race="{param@OfferRace}" voiceflags="32" object="{param@Cue}.{param@ID} L0Start" location="crew"/>
                                            <set_value name="{param@Cue}.{param@ID} Passenger Created" exact="1"/>
                                        </do_otherwise>
                                    </do_choose>
                                </do_otherwise>
                            </do_choose>
							
                            <!--<set_object name="this.PassengerObj" value="{actor@{param@Cue}.{param@ID} L0Passenger}"/>-->
                            <set_value name="{param@Cue}.{param@ID} L0Title" min="101001" max="{9620,101000}" profile="decreasing"/>
                            <!--create briefing-->
                            <do_choose>
                                <!--this first do_when only prevents an error in .dmp, is same as do_otherwise-->
                                <do_when value="{player.dockobject.exists}" exact="0">
                                    <create_briefing cue="{param@Cue}" text="{{param@PageID},{param@TextID}}" title="{9620,{value@{param@Cue}.{param@ID} L0Title}}">
					                    <requirements>
						                    <requirement value="tp" type="class" visible="{value@{param@Cue}.{param@ID} TPNeeded}"/>
						                    <requirement value="SS_WARE_LIFESUPPORT" type="equipment"/>
						                    <requirement value="{lookup.type.cargospace@SS_WARE_PASSENGER}" type="cargo" />
						                    <requirement value="{lookup.type.cargoclass@SS_WARE_PASSENGER}" type="tc"/>
					                    </requirements>
					                    <objectives>
                                            <objective step="{value@{param@Cue}.{param@ID} L0GI03Step}">
                                                <dockat object="{param@Cue}.{param@ID} L0Start"/>
                                            </objective>
                                            <objective step="{value@{param@Cue}.{param@ID} L0GI03Step}+1">
                                                <custom icon="flyto" action="{35,2043}" text="{actor.name@{param@Cue}.{param@ID} L0Passenger}"/>
                                            </objective>
                                            <objective step="{value@{param@Cue}.{param@ID} L0GI03Step}+2">
                                                <flyto object="{param@Cue}.{param@ID} L0Dest0"/>
                                            </objective>
                                        </objectives>
                                    </create_briefing>
                                    <set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0GI03Step}+2"/>
                                </do_when>
                                <do_when value="{object@{param@Cue}.{param@ID} L0Start}" exact="{player.dockobject}">
                                    <create_briefing cue="{param@Cue}" text="{{param@PageID},{param@TextID}}" title="{9620,{value@{param@Cue}.{param@ID} L0Title}}">
					                    <requirements>
						                    <requirement value="tp" type="class" visible="{value@{param@Cue}.{param@ID} TPNeeded}"/>
						                    <requirement value="SS_WARE_LIFESUPPORT" type="equipment"/>
						                    <requirement value="{lookup.type.cargospace@SS_WARE_PASSENGER}" type="cargo" />
						                    <requirement value="{lookup.type.cargoclass@SS_WARE_PASSENGER}" type="tc"/>
					                    </requirements>
					                    <objectives>
                                            <objective step="{value@{param@Cue}.{param@ID} L0GI03Step}">
                                                <custom icon="flyto" action="{35,2043}" text="{actor.name@{param@Cue}.{param@ID} L0Passenger}"/>
                                            </objective>
                                            <objective step="{value@{param@Cue}.{param@ID} L0GI03Step}+1">
                                                <flyto object="{param@Cue}.{param@ID} L0Dest0"/>
                                            </objective>
                                        </objectives>
                                    </create_briefing>
                                    <set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0GI03Step}+1"/>
                                </do_when>
                                <do_otherwise>
                                    <create_briefing cue="{param@Cue}" text="{{param@PageID},{param@TextID}}" title="{9620,{value@{param@Cue}.{param@ID} L0Title}}">
					                    <requirements>
						                    <requirement value="tp" type="class" visible="{value@{param@Cue}.{param@ID} TPNeeded}"/>
						                    <requirement value="SS_WARE_LIFESUPPORT" type="equipment"/>
						                    <requirement value="{lookup.type.cargospace@SS_WARE_PASSENGER}" type="cargo" />
						                    <requirement value="{lookup.type.cargoclass@SS_WARE_PASSENGER}" type="tc"/>
					                    </requirements>
					                    <objectives>
                                            <objective step="{value@{param@Cue}.{param@ID} L0GI03Step}">
                                                <dockat object="{param@Cue}.{param@ID} L0Start"/>
                                            </objective>
                                            <objective step="{value@{param@Cue}.{param@ID} L0GI03Step}+1">
                                                <custom icon="flyto" action="{35,2043}" text="{actor.name@{param@Cue}.{param@ID} L0Passenger}"/>
                                            </objective>
                                            <objective step="{value@{param@Cue}.{param@ID} L0GI03Step}+2">
                                                <flyto object="{param@Cue}.{param@ID} L0Dest0"/>
                                            </objective>
                                        </objectives>
                                    </create_briefing>
                                    <set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0GI03Step}+2"/>
                                </do_otherwise>
                            </do_choose>

							
							
							<set_value name="{param@Cue}.{param@ID} L0FirstDestStep" exact="{value@{param@Cue}.{param@ID} L0DestStep}"/>
						    <set_value name="this.Random" min="0" max="99"/>
							<do_choose>
                                <do_when value="{value@this.Random}" min="100-{param@HideDest}">
                                    <create_briefing cue="{param@Cue}">
					                    <objectives>
                                            <objective step="{value@{param@Cue}.{param@ID} L0DestStep}">
                                                <custom icon="flyto" action="{35,2007}" text="{3603,2002}"/>
                                            </objective>
                                        </objectives>
                                    </create_briefing>
                                </do_when>
								<do_otherwise>
									<!--  THIS DOESNT SEEM TO WORK (CREATE_BRIEFING CANCELS LOOP)
									<do_all counter="count" min="1" max="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}">
										<set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0DestStep}+1"/>										
										<create_briefing cue="{param@Cue}">
											<objectives>
												<objective step="{value@{param@Cue}.{param@ID} L0DestStep}">
													<flyto object="{group.object.{counter@count}@{param@Cue}.{param@ID} L0DestinationGroup}"/>
												</objective>
											</objectives>
										</create_briefing>										
										<incoming_message text="Counter = {counter@count}, Object={group.object.{counter@count}.name@{param@Cue}.{param@ID} L0DestinationGroup}"/>
									</do_all>
									-->
									<do_if value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" min="2">
										<set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0DestStep}+1"/>
										<create_briefing cue="{param@Cue}">
											<objectives>
												<objective step="{value@{param@Cue}.{param@ID} L0DestStep}">
													<flyto object="{group.object.2@{param@Cue}.{param@ID} L0DestinationGroup}"/>
												</objective>
											</objectives>
										</create_briefing>
									</do_if>
									<do_if value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" min="3">
										<set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0DestStep}+1"/>
										<create_briefing cue="{param@Cue}">
											<objectives>
												<objective step="{value@{param@Cue}.{param@ID} L0DestStep}">
													<flyto object="{group.object.3@{param@Cue}.{param@ID} L0DestinationGroup}"/>
												</objective>
											</objectives>
										</create_briefing>
									</do_if>
									<do_if value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" min="4">
										<set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0DestStep}+1"/>
										<create_briefing cue="{param@Cue}">
											<objectives>
												<objective step="{value@{param@Cue}.{param@ID} L0DestStep}">
													<flyto object="{group.object.4@{param@Cue}.{param@ID} L0DestinationGroup}"/>
												</objective>
											</objectives>
										</create_briefing>
									</do_if>
									<do_if value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" min="5">
										<set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0DestStep}+1"/>
										<create_briefing cue="{param@Cue}">
											<objectives>
												<objective step="{value@{param@Cue}.{param@ID} L0DestStep}">
													<flyto object="{group.object.5@{param@Cue}.{param@ID} L0DestinationGroup}"/>
												</objective>
											</objectives>
										</create_briefing>
									</do_if>
									<do_if value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" min="6">
										<set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0DestStep}+1"/>
										<create_briefing cue="{param@Cue}">
											<objectives>
												<objective step="{value@{param@Cue}.{param@ID} L0DestStep}">
													<flyto object="{group.object.6@{param@Cue}.{param@ID} L0DestinationGroup}"/>
												</objective>
											</objectives>
										</create_briefing>
									</do_if>
									<do_if value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" min="7">
										<set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0DestStep}+1"/>
										<create_briefing cue="{param@Cue}">
											<objectives>
												<objective step="{value@{param@Cue}.{param@ID} L0DestStep}">
													<flyto object="{group.object.7@{param@Cue}.{param@ID} L0DestinationGroup}"/>
												</objective>
											</objectives>
										</create_briefing>
									</do_if>
									<do_if value="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}" min="8">
										<set_value name="{param@Cue}.{param@ID} L0DestStep" exact="{value@{param@Cue}.{param@ID} L0DestStep}+1"/>
										<create_briefing cue="{param@Cue}">
											<objectives>
												<objective step="{value@{param@Cue}.{param@ID} L0DestStep}">
													<flyto object="{group.object.8@{param@Cue}.{param@ID} L0DestinationGroup}"/>
												</objective>
											</objectives>
										</create_briefing>
									</do_if>
								</do_otherwise>
							</do_choose>
                            <set_value name="L0GI03 B.StartTime" exact="{player.age}+7200"/>
                        </do_all>
                    </action>
                    <cues>
                        <cue ref="LUM04">
                            <params>
                                <param name="Discipline" value="XXXT"/>
                                <param name="RewardMult" value="2+{value@{param@Cue}.{param@ID} TPNeeded}+{value@{param@Cue}.{param@ID} HasXenon}+{value@{param@Cue}.{param@ID} HasXenon}"/>
                                <param name="StartTime" value="L0GI03 B.StartTime"/>
                                <param name="Duration" value="{param@Cue}.{param@ID} L0Time"/>
                            </params>
                        </cue>
		            </cues>
	            </cue>
            </cues>
        </cue>
      </cues>
    </cue>

    <cue name="L0GI03" library="1">
        <documentation>
            <content name="L0GI03 Courier" reference="XXXT" type="L0"/>
            <version date="06/12/2023" number="1.0" status="development"/>
            <params>
                <param name="Cue" compulsory="1" description="The cue where the briefing and objectives are stored"/>
                <param name="ID" type="number" compulsory="1" description="The mission Id for dealing with mission chains"/>
                <param name="OfferRace" compulsory="1" description="Race offering the mission"/>
                <param name="EnemyRace" compulsory="1" description="Race of the enemy"/>
                <param name="Lv1Guide" type="actorname" compulsory="1" description="The person offering the mission"/>
                <param name="PageID" description="Page ID of mission description"/>
                <param name="TextID" description="Text ID of mission description"/>
                <param name="Reward" description="Reward type"/>
                <param name="StoryID" compulsory="0" description="Text ID of the Story title" default="No title"/>
                <param name="Difficulty" compulsory="1" description="Difficulty level of mission"/>
                <param name="Step" compulsory="1" description="The starting Step of the mission"/>
                <param name="Leave End Passenger" compulsory="0" type="boolean" description="Let the passenger continue to exist when the mission ends"/>
            </params>
            <history>
			    <change date="06/12/2023" author="Cycrow" description="Re-written from 0.3 Passenger"/>
		    </history>
        </documentation>
        <action>
            <set_value name="{param@Cue}.{param@ID} L0GI03 Progress" exact="0"/>
        </action>
        <cues>
            <cue name="L0GI03 Mission">
                <cues>
                    <cue name="L0GI03 Go Start" check="cancel">
                        <condition comment="if player hasnt started at the starting point">
                            <check_any>
                                <object_is_docked dockobject="{param@Cue}.{param@ID} L0Start" negate="1"/>
                                <check_all>
                                    <match_object object="{param@Cue}.{param@ID} L0Start" class="station" negate="1"/>
                                    <check_distance value="{object.distance@{param@Cue}.{param@ID} L0Start}" min="5km"/>
                                </check_all>
                            </check_any>
                        </condition>
                        <action>
                            <do_all>
                                <set_value name="this.Travelled" exact="1"/>
                                <!--set the end time so we can calculate the remaining time-->
                                <set_value name="{param@Cue}.{param@ID} L0EndTime" exact="{value@{param@Cue}.{param@ID} L0Time}+{player.age}"/>
                                <!--set the objective / briefing-->
                                <set_objective cue="{param@Cue}" title="{9620,{value@{param@Cue}.{param@ID} L0Title}}">
                                    <briefing cue="{param@Cue}" step="{value@{param@Cue}.{param@ID} L0GI03Step}"/>
                                    <mission level="{param@Difficulty}" discipline="XXXT"/>
                                    <dockat object="{param@Cue}.{param@ID} L0Start"/>
                                </set_objective>
                                <create_briefing cue="{param@Cue}">
					                <objectives>
                                        <objective step="{value@{param@Cue}.{param@ID} L0GI03Step}+2">
                                            <flyto object="{param@Cue}.{param@ID} L0Dest"/>
                                        </objective>
                                    </objectives>
                                </create_briefing>

                                <set_value name="this.text" exact="1"/>
                                <do_if value="{actor@{param@Cue}.{param@ID} L0Passenger}" exact="{actor@{param@Lv1Guide}}">
                                    <set_value name="this.text" exact="2"/>
                                </do_if>
                                <do_choose>
                                    <do_when value="{param@AddText}" min="1">
                                        <incoming_message author="{actor.name@{param@Lv1Guide}}" text="{{param@PageID},{param@TextID}}\n\n{3603,{value@this.text}}" silent="1"/>
                                    </do_when>
                                    <do_otherwise>
                                        <incoming_message author="{actor.name@{param@Lv1Guide}}" text="{3603,{value@this.text}}" silent="1"/>
                                    </do_otherwise>
                                </do_choose>
                                <set_value name="L0GI03 Go Start.StartTime" exact="{player.age}"/>
                            </do_all>
                        </action>
                        <cues>
                            <cue ref="LUM04">
                                <params>
                                    <param name="StartTime" value="L0GI03 Go Start.StartTime"/>
                                    <param name="Duration" value="{param@Cue}.{param@ID} L0Time"/>
                                </params>
                            </cue>
                            <cue ref="LUM05">
                                <params>
                                    <param name="Duration" value="{param@Cue}.{param@ID} L0Time"/>
                                </params>
                            </cue>
                        </cues>
                    </cue>
                    <cue name="L0GI03 Cant Transport" delay="1000" version="3">
                        <condition>
                            <check_all>
                                <check_value value="{object.exists@{param@Cue}.{param@ID} L0Start}" exact="1"/>
                                <check_any>
                                    <object_is_docked dockobject="{object@{param@Cue}.{param@ID} L0Start}"/>
                                    <check_all>
                                        <match_object object="{param@Cue}.{param@ID} L0Start" class="station" negate="1"/>
                                        <check_distance value="{object.distance@{param@Cue}.{param@ID} L0Start}" max="5km"/>
                                    </check_all>
                                </check_any>
                                <check_any>
                                    <check_value value="{player.ship.cargoclass}" max="{lookup.type.cargoclass@SS_WARE_PASSENGER}-1"/>
                                    <check_value value="{player.ship.cargospace}" max="{lookup.type.cargospace@SS_WARE_PASSENGER}-1"/>
                                    <check_all>
                                        <object_has_equipment>
                                            <ware typename="SS_WARE_LIFESUPPORT" exact="0"/>
                                        </object_has_equipment>
                                        <match_object class="tp" negate="1"/>
                                    </check_all>
                                    <check_value value="{value@{param@Cue}.{param@ID} TPNeeded}-{player.ship.isclass.tp}" min="1"/>
                                </check_any>
                            </check_all>
                        </condition>
                        <timing>
                            <time exact="{text.duration@13,1502}+50"/>
                        </timing>
                        <action>
                            <do_all>
                                <do_choose>
                                    <do_when value="{value@{param@Cue}.{param@ID} TPNeeded}-{player.ship.isclass.tp}" min="1">
                                        <play_text actor="{param@Cue}.{param@ID} L0Passenger" textid="907" priority="99"/>
                                        <incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{{actor.voice@{param@Cue}.{param@ID} L0Passenger},907}" silent="1"/>
                                    </do_when>
                                    <do_otherwise>
                                        <do_choose>
                                            <do_when value="{player.ship.isclass.tp}" exact="1">
                                                <do_if value="{player.ship.cargospace}" max="{lookup.type.cargospace@SS_WARE_PASSENGER}-1">
                                                    <play_text actor="{param@Cue}.{param@ID} L0Passenger" textid="905" priority="99"/>
                                                    <incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{{actor.voice@{param@Cue}.{param@ID} L0Passenger},905}" silent="1"/>
                                                </do_if>
                                            </do_when>
                                            <do_otherwise>
                                                <do_choose>
                                                    <do_when value="{player.ship.cargo.SS_WARE_LIFESUPPORT.exists}" exact="0">
                                                        <play_text actor="{param@Cue}.{param@ID} L0Passenger" textid="906" priority="99"/>
                                                        <incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{{actor.voice@{param@Cue}.{param@ID} L0Passenger},906}" silent="1"/>
                                                    </do_when>
                                                    <do_otherwise>
                                                        <play_text actor="{param@Cue}.{param@ID} L0Passenger" textid="905" priority="99"/>
                                                        <incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{{actor.voice@{param@Cue}.{param@ID} L0Passenger},905}" silent="1"/>
                                                    </do_otherwise>
                                                </do_choose>
                                            </do_otherwise>
                                        </do_choose>
                                    </do_otherwise>
                                </do_choose>
								<set_objective cue="{param@Cue}" title="{9620,{value@{param@Cue}.{param@ID} L0Title}}">
									<briefing cue="{param@Cue}" step="{value@{param@Cue}.{param@ID} L0FirstDestStep}-1"/>
									<mission level="{param@Difficulty}" discipline="XXXT"/>
									<custom icon="flyto" action="{35,2043}" text="{actor.name@{param@Cue}.{param@ID} L0Passenger}" actor="{param@Cue}.{param@ID} L0Passenger"/>
								</set_objective>
                            </do_all>
                        </action>
                        <cues>
                            <cue name="L0GI03 Cant Transport Reset">
                                <condition>
                                    <object_undocked/>
                                </condition>
                                <timing>
                                    <time exact="1s"/>
                                </timing>
                                <action>
                                    <reset_cue cue="L0GI03 Cant Transport"/>
                                </action>
                            </cue>
                        </cues>
                    </cue>
            
					<!--NEED A HURRY UP CUE maybe?-->
                    <cue name="L0GI03 Time Out 1">
                        <condition comment="If mission Started and allowed to fail">
                            <check_all>
                                <cue_completed cue="L0GI03 Go Start"/>
                                <check_value value="{param@IsPlot}" exact="1" negate="1"/>
                            </check_all>
                        </condition>
                        <timing>
                            <time exact="{value@{param@Cue}.{param@ID} L0Time}s"/>
                        </timing>
                        <action>
                            <do_all>
                                <incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{3603,502}"/>
                                <set_value name="{param@Cue}.{param@ID} L0GI03 Progress" exact="92"/>
                                <cancel_cue cue="L0GI03 Mission"/>
                            </do_all>
                        </action>
                    </cue>
                    <cue name="L0GI03 Dest Destroyed 1">
                        <condition>
                            <check_any>
                                <any_object_destroyed group="{param@Cue}.{param@ID} L0DestinationGroup"/>
                                <any_object_destroyed_by_player group="{param@Cue}.{param@ID} L0DestinationGroup"/>
                            </check_any>
                        </condition>
                        <action>
                            <do_all>
                                <incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{3603,503}"/>
                                <set_value name="{param@Cue}.{param@ID} L0GI03 Progress" exact="93"/>
                                <cancel_cue cue="L0GI03 Mission"/>
                            </do_all>
                        </action>
                    </cue>
                    <cue name="L0GI03 Start Destroyed">
                        <condition>
                            <check_any>
                                <object_destroyed object="{param@Cue}.{param@ID} L0Start"/>
                                <object_destroyed_by_player object="{param@Cue}.{param@ID} L0Start"/>
                            </check_any>
                        </condition>
                        <action>
                            <do_all>
                                <set_value name="{param@Cue}.{param@ID} L0GI03 Progress" exact="99"/>
                                <cancel_cue cue="L0GI03 Mission"/>
                            </do_all>
                        </action>
                    </cue>
                    <cue name="L0GI03 At Start" delay="1000" version="3">
                        <condition>
                            <check_all>
                                <check_any>
                                    <object_has_equipment>
                                        <ware typename="SS_WARE_LIFESUPPORT" min="1"/>
                                    </object_has_equipment>
                                    <match_object class="tp"/>
                                </check_any>
                                <check_value value="{player.ship.cargoclass}" min="{lookup.type.cargoclass@SS_WARE_PASSENGER}"/>
                                <check_value value="{player.ship.cargospace}" min="{lookup.type.cargospace@SS_WARE_PASSENGER}"/>
                                <check_value value="{value@{param@Cue}.{param@ID} TPNeeded}-{player.ship.isclass.tp}" max="0"/>
                                <check_any>
                                    <object_is_docked dockobject="{param@Cue}.{param@ID} L0Start"/>
                                    <check_all>
                                        <match_object object="{param@Cue}.{param@ID} L0Start" class="station" negate="1"/>
                                        <check_distance value="{object.distance@{param@Cue}.{param@ID} L0Start}" max="5km"/>
                                    </check_all>
                                </check_any>
                                <check_value value="{object.exists@{param@Cue}.{param@ID} L0Start}" exact="1"/>
                            </check_all>
                        </condition>
                        <action>
                            <do_all>
                                <cancel_cue cue="L0GI03 Cant Transport"/>
                                <cancel_cue cue="L0GI03 Time Out 1"/>
                                <cancel_cue cue="L0GI03 Dest Destroyed 1"/>
                                <cancel_cue cue="L0GI03 Start Destroyed"/>
								<set_value name="{param@Cue}.{param@ID} L0Attacks" exact="0"/>
								<!--reset timer value if was  calculated earlier-->
                                <do_if value="{value@{param@Cue}.{param@ID} L0EndTime}" min="1">
                                    <set_value name="{param@Cue}.{param@ID} L0Time" exact="{value@{param@Cue}.{param@ID} L0EndTime}-{player.age}"/>
                                </do_if>
                                <!--add a small amount of time if very low-->
                                <do_if value="{value@{param@Cue}.{param@ID} L0Time}" max="240">
                                    <set_value name="{param@Cue}.{param@ID} L0Time" min="240" max="260"/>
                                </do_if>

                                <set_value name="this.hurry" min="{value@{param@Cue}.{param@ID} L0Time}/2" max="({value@{param@Cue}.{param@ID} L0Time}/2)+15"/>
								<set_object name="{param@Cue}.{param@ID} L0Dest" value="{group.object.1@{param@Cue}.{param@ID} L0DestinationGroup}"/>
								<set_value name="{param@Cue}.{param@ID} L0CurrentStep" exact="{value@{param@Cue}.{param@ID} L0FirstDestStep}"/>
								<set_value name="{param@Cue}.{param@ID} L0CurrentDest" exact="1"/>
								<create_briefing cue="{param@Cue}">
					                <objectives>
                                        <objective step="{value@{param@Cue}.{param@ID} L0FirstDestStep}">
                                            <flyto object="{object@{param@Cue}.{param@ID} L0Dest}"/>
                                        </objective>
                                    </objectives>
                                </create_briefing>
                                <set_objective cue="{param@Cue}" title="{9620,{value@{param@Cue}.{param@ID} L0Title}}">
                                    <briefing cue="{param@Cue}" step="{value@{param@Cue}.{param@ID} L0FirstDestStep}"/>
                                    <mission level="{param@Difficulty}" discipline="XXXT"/>
                                    <flyto object="{param@Cue}.{param@ID} L0Dest"/>
                                </set_objective>

                                <set_actor_location actor="{param@Cue}.{param@ID} L0Passenger" object="{player.ship}" location="passenger"/>
                                <do_if value="{value@{param@Cue}.{param@ID} L0UseStartTD}" exact="1">
                                    <play_sound soundid="991"/>
                                </do_if>
                                <set_value name="L0GI03 At Start.StartTime" exact="{player.age}"/>
                            </do_all>
                        </action>
                        <cues>
                            <cue name="L0GI03 At Start Speak">
                                <condition>
                                    <cue_completed cue="L0GI03 At Start"/>
                                </condition>
                                <timing>
                                    <time exact="{text.duration@13,1502}+50"/>
                                </timing>
                                <action>
                                    <play_text actor="{param@Cue}.{param@ID} L0Passenger" priority="99">
                                        <line actor="{param@Cue}.{param@ID} L0Passenger" textid="900"/>
                                        <line actor="{param@Cue}.{param@ID} L0Passenger" textid="901"/>
                                    </play_text>
                                </action>
                            </cue>
                            <cue ref="LUM04">
                                <params>
                                    <param name="StartTime" value="L0GI03 At Start.StartTime"/>
                                    <param name="Duration" value="{param@Cue}.{param@ID} L0Time"/>
                                </params>
                            </cue>
                            <cue ref="LUM05">
                                <params>
                                    <param name="StartTime" value="L0GI03 At Start.StartTime"/>
                                    <param name="Duration" value="{param@Cue}.{param@ID} L0Time"/>
                                </params>
                            </cue>
                            <cue name="L0GI03 Hurry 2">
                                <condition>
                                    <cue_completed cue="L0GI03 At Start"/>
                                </condition>
                                <timing>
                                    <time exact="{value@L0GI03 At Start.hurry}s"/>
                                </timing>
                                <action>
                                    <do_if value="{actor.ship@{param@Cue}.{param@ID} L0Passenger}" exact="{player.ship}">
                                        <play_text actor="{param@Cue}.{param@ID} L0Passenger" textid="80" priority="99"/>
                                    </do_if>
                                </action>
                            </cue>
                            <cue name="L0GI03 Time Out 2">
                                <condition>
                                    <check_all>
                                        <cue_completed cue="L0GI03 At Start"/>
                                        <check_value value="{param@IsPlot}" exact="1" negate="1"/>
                                    </check_all>
                                </condition>
                                <timing>
                                    <time exact="{value@{param@Cue}.{param@ID} L0Time}s"/>
                                </timing>
                                <action>
                                    <do_all>
                                        <set_value name="{param@Cue}.{param@ID} L0GI03 Progress" exact="2"/>
                                        <cancel_cue cue="L0GI03 Mission"/>
                                    </do_all>
                                </action>
                            </cue>
                            <cue name="L0GI03 Ejected" delay="3s">
                                <condition>
                                    <match_object object="{actor.ship@{param@Cue}.{param@ID} L0Passenger}" class="astronaut"/>
                                </condition>
                                <action>
                                    <do_all>
                                        <do_choose>
                                            <do_when value="{actor.sector@{param@Cue}.{param@ID} L0Passenger}" exact="{player.sector}">
                                                <play_text actor="{param@Cue}.{param@ID} L0Passenger" textid="852" priority="99"/>
                                            </do_when>
                                            <do_otherwise>
                                                <incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{{actor.voice@{param@Cue}.{param@ID} L0Passenger},852}"/>
                                            </do_otherwise>
                                        </do_choose>
                                        <set_value name="{param@Cue}.{param@ID} L0GI03 Progress" exact="5"/>
                                        <cancel_cue cue="L0GI03 Mission"/>
                                    </do_all>
                                </action>
                            </cue>
                            <cue name="L0GI03 Dest Destroyed 2" delay="5s">
                                <condition>
                                    <check_value value="{object.exists@{param@Cue}.{param@ID} L0Dest}" exact="0"/>
                                </condition>
                                <action>
                                    <do_all>
                                        <find_station name="{param@Cue}.{param@ID} L0Dest" class="trade" dockingallowed="1" findobject="{player.ship}" nearest="1"/>
                                        <do_if value="{object.exists@{param@Cue}.{param@ID} L0Start}" exact="0">
                                            <find_station name="{param@Cue}.{param@ID} L0Dest" class="dock" dockingallowed="1" findobject="{player.ship}" nearest="1"/>
                                        </do_if>
                                        <do_if value="{object.exists@{param@Cue}.{param@ID} L0Dest}" exact="0">
                                            <find_station name="{param@Cue}.{param@ID} L0Dest" class="station" dockingallowed="1" findobject="{player.ship}" nearest="1"/>
                                        </do_if>
                                        <set_value name="this.step" exact="{value@{param@Cue}.{param@ID} L0GI03Step}"/>
                                        <do_if value="{value@L0GI03 Go Start.Travelled}" exact="1">
                                            <set_value name="this.step" exact="{value@{param@Cue}.{param@ID} L0GI03Step}+2"/>
                                        </do_if>
                                        <do_choose>
                                            <do_when value="{object.exists@{param@Cue}.{param@ID} L0Dest}" exact="1">
                                                <create_briefing cue="{param@Cue}">
							                        <objectives>
                                                        <objective step="{value@this.step}">
                                                            <flyto object="{param@Cue}.{param@ID} L0Dest"/>
                                                        </objective>
                                                    </objectives>
                                                </create_briefing>
                                                <set_objective cue="{param@Cue}">
                                                    <briefing cue="{param@Cue}" step="{value@this.step}"/>
                                                    <mission level="{param@Difficulty}" discipline="XXXT"/>
                                                        <flyto object="{param@Cue}.{param@ID} L0Dest"/>
                                                </set_objective>
                                                <do_if value="{actor.ship@{param@Cue}.{param@ID} L0Passenger}" exact="{player.ship}">
                                                    <play_text priority="99">
                                                        <line actor="{param@Cue}.{param@ID} L0Passenger" textid="849"/>
                                                        <line actor="{param@Cue}.{param@ID} L0Passenger" textid="901"/>
                                                    </play_text>
                                                </do_if>
                                                <reset_cue cue="L0GI03 Dest Destroyed 2"/>
                                            </do_when>
                                            <do_otherwise>
                                                <incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{3603,503}"/>
                                                <set_value name="{param@Cue}.{param@ID} L0GI03 Progress" exact="93"/>
                                                <cancel_cue cue="L0GI03 Mission"/>
                                            </do_otherwise>
                                        </do_choose>
                                    </do_all>
                                </action>
                            </cue>
							<cue name="L0GI03 SpawnXenon">
								<condition>
									<check_all>
										<object_sector exact="0">
											<sector sector="{object.sector@{param@Cue}.{param@ID} L0Dest}"/>
										</object_sector>
										<check_value value="{value@{param@Cue}.{param@ID} CreateXenon}" exact="1"/>
									</check_all>
								</condition>
								<action>
									<set_value name="{param@Cue}.{param@ID} CreateXenon" exact="0"/>
								</action>
								<cues>
									<cue name="L0GI03 ref OBS">
										<cues>
									        <cue ref="OBS">
										        <params>
											        <param name="OBS Cue" value="{param@Cue}"/>
											        <param name="OBS Cancel Cue" value="L0GI03 ref OBS" comment="The cue which is canceled after the OBS finishes"/>
											        <param name="OBS Fleet Group Name" value="Enemies" comment="The group name where all main ships are saved too"/>
											        <param name="OBS Support Fleet Group Name" value="Enemies" comment="The group name where all support ships are saved too"/>
											        <param name="OBSPosition" value="5km" comment="how far away should the OBS ships be from FleetPositionObject"/>
											        <param name="OBSSector" value="{object.sector@{param@Cue}.{param@ID} L0Dest}" comment="The sector where the ships will spawn if OBSFleetPositionObject not set"/>
													<param name="OBSFleetPositionObject" value="{object@{param@Cue}.{param@ID} L0Dest}"/>
													<param name="OBSFleetRace" value="{lookup.race@xenon}"/>
													<param name="OBSFleetPilotsRace" value="{lookup.race@xenon}"/>
													<param name="OBSFleetRelation" value="-1"/>
													<param name="OBSFleetCommunicates" value="0"/>
													<param name="OBSMissionRank" value="{player.traderank.rank}" comment="A 0-30 scale preferably based on the players trade rank"/>
													<param name="OBSDifficultyRank" value="{param@Difficulty}" comment="A 1-8 scale of difficulty"/>
												</params>
									        </cue>
										</cues>
									</cue>
									<cue name="L0GI03 XenonAttack">
										<condition>
											<check_all>
												<cue_cancelled cue="L0GI03 ref OBS"/>
												<cue_is_complete cue="L0GI03 SpawnXenon"/>
											</check_all>
										</condition>
										<action>
											<set_group_command group="{param@Cue}.Enemies" command="stay"/>
										</action>
										<cues>
											<cue name="L0GI03 StartAttack">
												<condition>
													<object_sector exact="0">
														<sector sector="{object.sector@{param@Cue}.{param@ID} L0Dest}"/>
													</object_sector>
												</condition>
												<action>
													<do_all>
														<set_value name="{param@Cue}.{param@ID} L0Attacks" operation="add" exact="1"/>
														<set_group_command group="{param@Cue}.Enemies" command="attack" commandobject="{player.ship}"/>
														<remove_group group="{param@Cue}.Enemies"/>
													</do_all>
												</action>
											</cue>
										</cues>
									</cue>
								</cues>
							</cue>
                            <cue name="L0GI03 At Dest" version="3" delay="1s">
                                <condition>
                                    <check_any>
                                        <check_all>
                                            <object_exists object="{param@Cue}.{param@ID} L0Dest"/>
                                            <object_is_docked dockobject="{object@{param@Cue}.{param@ID} L0Dest}"/>
                                            <check_value value="{actor.ship@{param@Cue}.{param@ID} L0Passenger}" exact="{player.ship}"/>
                                        </check_all>
                                        <check_all>
                                            <object_exists object="{param@Cue}.{param@ID} L0Dest"/>
                                            <match_object object="{param@Cue}.{param@ID} L0Dest" class="station" negate="1"/>
                                            <check_distance value="{object.distance@{param@Cue}.{param@ID} L0Dest}" max="5km"/>
                                            <check_value value="{actor.ship@{param@Cue}.{param@ID} L0Passenger}" exact="{player.ship}"/>
                                            <check_value value="{object.exists@{param@Cue}.{param@ID} L0Dest}" exact="1"/>
                                        </check_all>
                                    </check_any>
                                </condition>
                                <timing>
                                    <time min="10s" max="15s"/>
                                </timing>
                                <action>
                                    <do_all>
										<set_value name="{param@Cue}.{param@ID} L0CurrentDest" exact="{value@{param@Cue}.{param@ID} L0CurrentDest}+1"/>
										<do_choose>
											<do_when value="{value@{param@Cue}.{param@ID} L0CurrentDest}" max="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}">
												<set_object name="{param@Cue}.{param@ID} L0Dest" value="{group.object.{value@{param@Cue}.{param@ID} L0CurrentDest}@{param@Cue}.{param@ID} L0DestinationGroup}"/>
												<set_value name="{param@Cue}.{param@ID} L0CurrentStep" exact="{value@{param@Cue}.{param@ID} L0CurrentStep}+1"/>
												<set_objective cue="{param@Cue}">
													<briefing cue="{param@Cue}" step="{value@{param@Cue}.{param@ID} L0CurrentStep}"/>
													<mission level="{param@Difficulty}" discipline="XXXT"/>
													<flyto object="{param@Cue}.{param@ID} L0Dest"/>
												</set_objective>
												<play_text actor="{param@Cue}.{param@ID} L0Passenger" priority="99">
													<line actor="{param@Cue}.{param@ID} L0Passenger" textid="817"/>
													<line actor="{param@Cue}.{param@ID} L0Passenger" textid="901"/>
												</play_text>
												<set_value name="{param@Cue}.{param@ID} CreateXenon" exact="0"/>
												<do_if value="{value@{param@Cue}.{param@ID} HasXenon}" exact="1">
													<do_choose>
														<do_when value="{value@{param@Cue}.{param@ID} L0Attacks}" exact="0">
															<set_value name="this.Random" min="1" max="50"/>
														</do_when>
														<do_when value="{value@{param@Cue}.{param@ID} L0Attacks}" exact="1">
															<set_value name="this.Random" min="1" max="80"/>
														</do_when>
														<do_otherwise>
        													<set_value name="this.Random" min="1" max="100"/>
														</do_otherwise>
													</do_choose>
													<do_if value="{value@{param@Cue}.{param@ID} L0CurrentDest}" exact="{group.object.count@{param@Cue}.{param@ID} L0DestinationGroup}-1">
														<do_if value="{value@{param@Cue}.{param@ID} L0Attacks}" exact="0">
															<set_value name="this.Random" exact="1"/>
														</do_if>
													</do_if>
													<do_if value="{value@this.Random}" max="30">
														<set_value name="{param@Cue}.{param@ID} CreateXenon" exact="1"/>
														<reset_cue cue="L0GI03 SpawnXenon"/>
													</do_if>
												</do_if>
												<reset_cue cue="L0GI03 At Dest"/>
											</do_when>
											<do_otherwise>
												<do_if value="{object.isclass.station@{param@Cue}.{param@ID} L0Dest}" exact="0">
													<play_sound soundid="991"/>
												</do_if>
												<set_value name="this.dialog" list="841|842"/>
												<set_value name="this.text" min="101" max="{3603,100}"/>
												<do_choose>
													<do_when value="{actor.ship@{param@Cue}.{param@ID} L0Passenger}" exact="{player.ship}">
														<play_text actor="{param@Cue}.{param@ID} L0Passenger" textid="{value@this.dialog}" priority="99"/>
														<incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{3603,{value@this.text}} {{actor.voice@{param@Cue}.{param@ID} L0Passenger},{value@this.dialog}}" silent="1"/>
													</do_when>
													<do_otherwise>
														<incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{3603,{value@this.text}} {{actor.voice@{param@Cue}.{param@ID} L0Passenger},{value@this.dialog}}"/>
													</do_otherwise>
												</do_choose>
												<set_value name="{param@Cue}.{param@ID} L0GI03 Progress" exact="1"/>
												<clear_actor_location actor="{param@Cue}.{param@ID} L0Passenger"/>
												<do_if value="{param@Leave End Passenger}" exact="1" negate="1">
													<destroy_actor actor="{param@Cue}.{param@ID} L0Passenger"/>
												</do_if>
												<cancel_cue cue="L0GI03 Mission"/>
											</do_otherwise>
										</do_choose>
									</do_all>
                                </action>
                            </cue>
                        </cues>
                    </cue>
                    <!--NEED A CUE TO ADD ENEMY ATTACKS WHEN CHANGING SECTOR-->
                    <!--NEED A CUE TO ADD ENEMY ATTACKS BEFORE DESTINATION-->
                    <!--NEED A CUE TO CREATE POLICE IN CASE OF AN ILLEGAL PASSENGER?-->
                     <cue name="L0GI03 Killed" delay="150">
                        <condition>
                            <check_value value="{actor.exists@{param@Cue}.{param@ID} L0Passenger}" exact="0"/>
                        </condition>
                        <action>
                            <do_all>
                                <set_value name="{param@Cue}.{param@ID} L0GI03 Progress" exact="3"/>
                                <cancel_cue cue="L0GI03 Mission"/>
                            </do_all>
                        </action>
                    </cue>
                    <cue name="L0GI03 Aborted">
                        <condition>
                            <objective_cancelled cue="{param@Cue}"/>
                        </condition>
                        <action>
                            <do_all>
                                <set_value name="{param@Cue}.{param@ID} L0GI03 Progress" exact="99"/>
                                <cancel_cue cue="L0GI03 Mission"/>
                            </do_all>
                        </action>
                    </cue>
                </cues>
            </cue>
            <cue name="L0GI03 Cleanup">
                <condition>
                    <check_value value="{value@{param@Cue}.{param@ID} L0GI03 Progress}" min="1"/>
                </condition>
                <action>
                    <do_choose>
                        <!--actor dead, nothing needed-->
                        <do_when value="{actor.exists@{param@Cue}.{param@ID} L0Passenger}" exact="0">
                            <cancel_cue cue="L0GI03 Cleanup Actor"/>
                        </do_when>
                        <!--actor aboard player ship, must be time out or abort-->
                        <do_when value="{actor.ship@{param@Cue}.{param@ID} L0Passenger}" exact="{player.ship}">
                            <set_value name="this.TextID" list="81|903"/>
                            <play_text actor="{param@Cue}.{param@ID} L0Passenger" textid="{value@this.TextID}" priority="99"/>
                            <incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{{actor.voice@{param@Cue}.{param@ID} L0Passenger},{value@this.TextID}}" silent="1"/>
                        </do_when>
                        <!--actor aboard player owned ship, must be time out or abort-->
                        <do_when value="{actor.ship.race@{param@Cue}.{param@ID} L0Passenger}" exact="{lookup.race@player}">
                            <set_value name="this.TextID" list="81|903"/>
                            <incoming_message author="{actor.name@{param@Cue}.{param@ID} L0Passenger}" text="{{actor.voice@{param@Cue}.{param@ID} L0Passenger},{value@this.TextID}}" popup="1"/>
                        </do_when>
                        <!--actor is astronaut, was ejected-->
                        <do_when value="{actor.ship.isclass.astronaut@{param@Cue}.{param@ID} L0Passenger}" exact="1">
                            <find_station name="this.ActorDest" class="station" dockingallowed="1" findobject="{actor.ship@{param@Cue}.{param@ID} L0Passenger}" nearest="1"/>
                            <set_command object="{actor.ship@{param@Cue}.{param@ID} L0Passenger}" command="dock" commandobject="this.ActorDest"/>
                        </do_when>
                        <!--else actor not picked up then-->
                        <do_otherwise>
                            <do_if value="{actor.exists@{param@Cue}.{param@ID} L0Passenger}" exact="1">
                                <do_choose>
                                    <do_when value="{value@{param@Cue}.{param@ID} Passenger Created}" exact="1">
                                        <do_if value="{param@Leave End Passenger}" exact="1" negate="1">
                                            <destroy_actor actor="{param@Cue}.{param@ID} L0Passenger"/>
                                        </do_if>
                                    </do_when>
                                    <do_otherwise>
                                        <clear_actor_location actor="{param@Cue}.{param@ID} L0Passenger"/>
                                    </do_otherwise>
                                </do_choose>
                            </do_if>
                            <cancel_cue cue="L0GI03 Cleanup Actor"/>
                        </do_otherwise>
                    </do_choose>
                </action>
                <cues>
                    <cue name="L0GI03 Cleanup Actor">
                        <cues>
                            <cue name="L0GI03 Cleanup Actor Destroyed" delay="235" version="2" comment="V2. Exist check corrected">
                                <condition>
                                    <check_value value="{actor.exists@{param@Cue}.{param@ID} L0Passenger}" exact="0"/>
                                </condition>
                                <action>
                                    <cancel_cue cue="L0GI03 Cleanup Actor Depart"/>
                                </action>
                            </cue>
                            <cue name="L0GI03 Cleanup Actor Depart" delay="250">
                                <condition>
                                    <object_is_docked object="{actor.ship@{param@Cue}.{param@ID} L0Passenger}"/>
                                </condition>
                                <action>
                                    <do_if value="{actor.exists@{param@Cue}.{param@ID} L0Passenger}" exact="1">
                                        <set_object name="this.ship" value="{actor.ship@{param@Cue}.{param@ID} L0Passenger}"/>
                                        <do_choose>
                                            <do_when value="{value@{param@Cue}.{param@ID} Passenger Created}" exact="1">
                                                <do_if value="{param@Leave End Passenger}" exact="1" negate="1">
                                                    <destroy_actor actor="{param@Cue}.{param@ID} L0Passenger"/>
                                                </do_if>
                                            </do_when>
                                            <do_otherwise>
                                                <clear_actor_location actor="{param@Cue}.{param@ID} L0Passenger"/>
                                            </do_otherwise>
                                        </do_choose>
                                        <do_if value="{object.isclass.astronaut@this.ship}" exact="1">
                                            <destroy_object object="this.ship"/>
                                        </do_if>
                                        <do_if value="{object.exists@this.ship}" exact="1">
                                            <remove_object object="this.ship"/>
                                        </do_if>
                                        <cancel_cue cue="L0GI03 Cleanup Actor Destroyed"/>
                                    </do_if>
                                </action>
                            </cue>
                        </cues>
                    </cue>
                </cues>
            </cue>
        </cues>
    </cue>
  </cues>
</director>
